<!DOCTYPE html>
<meta charset="utf-8">
<script src="../authentication/js/environment.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script type="text/javascript" src="script/jquery-3.3.1.js"></script>
<script defer type="text/javascript" src="script/jquery.csv.min.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
<!-- <script src='/script/jquery-ui.js'></script>
   <script  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="  crossorigin="anonymous"></script>-->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="script/d3-legend.min.js"></script>
<script type="text/javascript" src="script/math.js"></script>
<link rel="stylesheet" type="text/css" href="css/network.css">

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Chosen CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css">

<!-- jQuery (required for Chosen) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Chosen JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>

<!-- Chosen CSS -->
<link rel="stylesheet" href="/node_modules/chosen-js/chosen.min.css">

<!-- jQuery (required for Chosen) -->
<!-- <script src="/node_modules/jquery.min.js"></script> -->

<!-- Chosen JS -->
<script src="/node_modules/chosen-js/chosen.jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


<!-- <script src="./.url.js"></script> -->

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
	integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	crossorigin="anonymous"></script>
	
<script>
	if (localStorage.getItem('isLoggedIn') !== 'true') {
			window.location.href = 'index.html'; 
		}

	const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
	const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

	function getItemFromStorage(key) {
		if (window.location.pathname.split('/').includes("pdnet_dev")) {
			return localStorage.getItem(key + '_dev');
		} else {
			return localStorage.getItem(key);
		}
	}

	function setItemToStorage(key, item) {
		if (window.location.pathname.split('/').includes("pdnet_dev")) {
			localStorage.setItem(key + '_dev', item);
		} else {
			localStorage.setItem(key, item);
		}
	}

	
	//An ajax call to read universal node file which contain data for different filters.
	// $.getJSON( "data/json/GRCH38-p12-uniNode_V4.json", function( json ) {
	// 	console.log( "JSON Data received, name is " + json.name);
	// });
	// $.ajax({
	// 	//url: 'data/json/GRCH38-p12-uniNode_V4.json', // taking long time to load
	// 	url: 'data/json/PD_universal_GRCH38p13_V4.json', // taking long time to load
	// 	dataType: 'json',
	// 	// crossDomain: 'http://*',
	// 	success: function (data) {
	function getUniversal(data, headers) {
		console.log("uniNode loaded ")
		uniNode = data;
		var uniNodeHeaders = Object.keys(uniNode?.genes?.[0]);
		if (headers) {
			headers.forEach((header) => {
				if (!uniNodeHeaders.includes(header)) {
					uniNodeHeaders.push(header);
				}
			});
		}
		//Seperate different headers like Pathways, Directions, etc. to populate corresponding drop-down
		var uniNodeLogFC = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("logFC_".toLowerCase()));
		// var uniNodePLogFC = uniNodeLogFC.filter((header) => header.toLowerCase().startsWith("logFC_proteomics".toLowerCase()));
		var uniNodeGLogFC = uniNodeLogFC.filter((header) => header.toLowerCase().startsWith("logFC_".toLowerCase()));
		var uniNodeDirection = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("direction_".toLowerCase()));
		var uniNodePathway = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("pathway_".toLowerCase()));
		var uniNodeMarkers = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("CellType_".toLowerCase()));
		var uniNodePvalue = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("pvalue_".toLowerCase()));
		var uniNodeDruggability = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("Druggability_".toLowerCase()));
		var uniNodeGWAS = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("GWAS_".toLowerCase()));
		var uniNodeGWAS_OR = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("GWAS_OR_".toLowerCase()));
		var uniNodeGWAS_Beta = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("GWAS_Beta_".toLowerCase()));
		var uniNodeDBs = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("database_".toLowerCase()));
		var uniNodeCustomColors = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("custom_color_".toLowerCase()));
		var uniNodeRelevence = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("relevence_".toLowerCase()));
		var uniNodeGDA = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("GDA_".toLowerCase()));
		var uniNodeTE = uniNodeHeaders.filter((header) => header.toLowerCase().startsWith("TE_".toLowerCase()));
		//************************* TO POPULATE DROP DOWNS
		//Populate all the dropdowns (logFCID4Color, directionID4Color, etc.)  in left menu with different headers

		// For TE Color
		for (var key = 0; key < uniNodeTE.length; key++) {
			$('<option/>').val(uniNodeTE[key]).text(jsUcFirst(uniNodeTE[key])).appendTo('#TE4Color')
			$('#TE4Color').trigger("chosen:updated");
		}		
		// Adding TE options to the node cut-off in Radial Analysis section
		var allValues = [];
		$('#TE4Color option').each(function() {
    		allValues.push($(this).val());
		});
		// Add each value from allValues to the #nodeDegreeID4Size dropdown after "Gene Degree"
		var TE_cutOff = allValues.forEach(function(value) {
    		$('<option/>').val(value).text(value).insertAfter('#nodeDegreeID4Size option[value="node_degree"]');
		});
       $('#nodeDegreeID4Size').trigger("chosen:updated");
	 
		//For TE Size
		for (var key = 0; key < uniNodeTE.length; key++) {
			$('<option/>').val(uniNodeTE[key]).text(jsUcFirst(uniNodeTE[key])).appendTo(
				'#TE4Size')
			$('#TE4Size').trigger("chosen:updated");

		};

		// For GDA Color
		for (var key = 0; key < uniNodeGDA.length; key++) {
			$('<option/>').val(uniNodeGDA[key]).text(jsUcFirst(uniNodeGDA[key])).appendTo('#GDAID4Color')
			$('#GDAID4Color').trigger("chosen:updated");
			$('<option/>').val(uniNodeGDA[key]).text(jsUcFirst(uniNodeGDA[key])).appendTo('#GDAID4Size')
			$('#GDAID4Size').trigger("chosen:updated");
		}

		// Populate Druggability dropdown
		for (var key = 0; key < uniNodeDruggability.length; key++) {
			$('<option/>').val(uniNodeDruggability[key]).text(jsUcFirst(uniNodeDruggability[key])).appendTo('#druggabilityID4Color')
			$('#druggabilityID4Color').trigger("chosen:updated");
		}
		// Populate GWAS OR dropdown
		for (var key = 0; key < uniNodeGWAS_OR.length; key++) {
			$('<option/>').val(uniNodeGWAS_OR[key]).text(jsUcFirst(uniNodeGWAS_OR[key])).appendTo('#GWAS_OR4Color');
		}

		// Populate GWAS Beta dropdown
		for (var key = 0; key < uniNodeGWAS_Beta.length; key++) {
			$('<option/>').val(uniNodeGWAS_Beta[key]).text(jsUcFirst(uniNodeGWAS_Beta[key])).appendTo('#GWAS_Beta4Color');
		}

		for (var key = 0; key < uniNodeLogFC.length; key++) {
			$('<option/>').val(uniNodeLogFC[key]).text(jsUcFirst(uniNodeLogFC[key])).appendTo(
				'#logFCID4Color')
			$('#logFCID4Color').trigger("chosen:updated");
		};

		//For Direction Color
		for (var key = 0; key < uniNodeDirection.length; key++) {
			$('<option/>').val(uniNodeDirection[key]).text(jsUcFirst(uniNodeDirection[key])).appendTo(
				'#directionID4Color')
			$('#directionID4Color').trigger("chosen:updated");
		};


		//For Direction Shape
		//for (var key = 0; key < uniNodeDirection.length; key++) {
		//$('<option/>').val(uniNodeDirection[key]).text(jsUcFirst(uniNodeDirection[key])).appendTo('#directionID4Shape')
		//};

		//For Pathways color
		for (var key = 0; key < uniNodePathway.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			$('<option/>').val(uniNodePathway[key]).text(jsUcFirst(uniNodePathway[key])).appendTo(
				'#pathwayID4Color')
			$('#pathwayID4Color').trigger("chosen:updated");
		};



		//For Custom color
		for (var key = 0; key < uniNodeCustomColors.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			$('<option/>').val(uniNodeCustomColors[key]).text(jsUcFirst(uniNodeCustomColors[key])).appendTo(
				'#custom4Color')
			$('#custom4Color').trigger("chosen:updated");
		};

		//For Pathways Shape
		for (var key = 0; key < uniNodePathway.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			$('<option/>').val(uniNodePathway[key]).text(jsUcFirst(uniNodePathway[key])).appendTo(
				'#pathwayID4Shape')
		};


		for (var key = 0; key < uniNodeGLogFC.length; key++) {
			$('<option/>').val(uniNodeGLogFC[key]).text(jsUcFirst(uniNodeGLogFC[key])).appendTo(
				'#GlogFCID4Size')
			$('#GlogFCID4Size').trigger("chosen:updated");
		};

		//Trait for Size
		for (var key = 0; key < uniNodeDruggability.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeDruggability[key] != "druggability_Module_ID") $('<option/>').val(uniNodeDruggability[key]).text(
				jsUcFirst(uniNodeDruggability[key])).appendTo('#druggabilityID4Size')
			$('#druggabilityID4Size').trigger("chosen:updated");
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};
		//GWAS 4 color
		for (var key = 0; key < uniNodeGWAS.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeGWAS[key] != "GWAS_Module_ID") $('<option/>').val(uniNodeGWAS[key]).text(jsUcFirst(
				uniNodeGWAS[key])).appendTo('#GWAS4Color')
			$('#GWAS4Color').trigger("chosen:updated");
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};
		//GWAS 4 shape
		for (var key = 0; key < uniNodeGWAS.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeGWAS[key] != "GWAS_Module_ID") $('<option/>').val(uniNodeGWAS[key]).text(jsUcFirst(
				uniNodeGWAS[key])).appendTo('#GWAS4Shape')
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};
		//GWAS 4 Size
		for (var key = 0; key < uniNodeGWAS.length; key++) {

			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeGWAS[key] != "GWAS_Module_ID") $('<option/>').val(uniNodeGWAS[key]).text(jsUcFirst(
				uniNodeGWAS[key])).appendTo('#gwasID4Size')
			$('#gwasID4Size').trigger("chosen:updated");
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};
		//Databases 4 color
		for (var key = 0; key < uniNodeDBs.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeDBs[key] != "DBs_Module_ID") $('<option/>').val(uniNodeDBs[key]).text(jsUcFirst(
				uniNodeDBs[key])).appendTo('#DBs4Color')
			$('#DBs4Color').trigger("chosen:updated");
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};

		//Databases 4 Shape
		for (var key = 0; key < uniNodeDBs.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeDBs[key] != "DBs_Module_ID") $('<option/>').val(uniNodeDBs[key]).text(jsUcFirst(
				uniNodeDBs[key])).appendTo('#DBs4Shape')
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};

		//CellType_Markers 4 color
		for (var key = 0; key < uniNodeMarkers.length; key++) {
			//var val = sample[0]+"_"+pathwayList[key];
			if (uniNodeMarkers[key] != "markers_Module_ID") $('<option/>').val(uniNodeMarkers[key]).text(
				jsUcFirst(uniNodeMarkers[key])).appendTo('#markers4Color')
			//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		};

		//CellType_Markers 4 shape
		for (var key = 0; key < uniNodeMarkers.length; key++) {

			if (uniNodeMarkers[key] != "markers_Module_ID") $('<option/>').val(uniNodeMarkers[key]).text(
				jsUcFirst(uniNodeMarkers[key])).appendTo('#markers4Shape')

		};

		// for (var key = 0; key < uniNodeDruggability.length; key++) {
		// 	//var val = sample[0]+"_"+pathwayList[key];
		// 	if (uniNodeDruggability[key] != "druggability_Module_ID") $('<option/>').val(uniNodeDruggability[key]).text(
		// 		jsUcFirst(uniNodeDruggability[key])).appendTo('#nodeDegreeID4Size')
		// 	$('#nodeDegreeID4Size').trigger("chosen:updated");
		// 	//$('<option/>').val("trait_" + traitList[key]).text(jsUcFirst(traitList[key])).appendTo('#druggabilityID4Size')
		// };

		//  relevence in  radial analysis
		// for(let key=0; key<uniNodeRelevence.length; key++){
		// 	$('<option/>').val(uniNodeGLogFC[key]).text(jsUcFirst(uniNodeGLogFC[key])).appendTo('#nodeDegreeID4Size')
		// }

		//console.log("uniNode: ", uniNode)

	}
	// 	statusCode: {
	// 		404: function () {
	// 			alert('There was a problem with the server.  Try again soon!');
	// 		}
	// 	}
	// });
	//End of ajax call.

	$(document).ready(function () {
		$('.chosen-select').chosen({
			width: '100%',
			search_contains: true,
		});
	});




	$(function () {
		$('[data-toggle="tooltip"]').tooltip()
	});
</script>

<body>


	<div id="loader" class="spinner-box">
		<div class="circle-border">
			<div class="circle-core"></div>
		</div>
	</div>
	<!-- table for selected nodes -->
	<div style="display: none;" id="node-modal-background-alert">
		<div id="alertModal">
			<div class="modal-header">
				<span class="alert header-text">
					Big Network Alert!
				</span>
				<button class="modal-close-btn" onclick="closeAlert()">x</button>
			</div>
			<div class="modal-body">
				<ul>
					<li style="font-size: 12px">
						Network is bigger in size. Number of nodes or interactions are high.
					</li>
					<li style="font-size: 12px">
						Displaying network for top 5000 genes.
						<!-- The Network for 5000 genes are render slow. -->
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!-- table for selected nodes -->
	<div style="display: none;" id="node-modal-background">
		<div id="nodeModal">
			<div class="modal-header">
				<span class="header-text">
					Node Details
				</span>
				<button class="modal-close-btn" onclick="closeModal()">x</button>	
			</div>
			
			<div class="modal-body">
				<table class="fixed_header">
					<thead>
						<tr>
							<th style="width: 50px;">No.</th>
							<th>Gene</th>
							<th>Ensemble</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody id="table_data-ip">
						<tr>
							<td>row 1-0</td>
							<td>row 1-1</td>
							<td>row 1-2</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- table for selected hub genes -->
	<div style="display:none" id="node-modal-background-2">
		<div id="nodeModal-2">
			<div class="modal-header">
				<span class="header-text">
					Node Details(hub genes)
				</span>
				<button class="modal-close-btn" onclick="closeModalHUB()">x</button>
			</div>
			<div class="modal-body">
				<table class="fixed_header">
					<thead>
						<tr>
							<th style="width: 50px;">No.</th>
							<th>Gene</th>
							<th>Ensemble</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody id="table_data-ip-2">
						<tr>
							<td style="width: 50px;">2000.</td>
							<td>row 1-1</td>
							<td>row 1-2</td>
							<td style="width: 360px;">row 1-2</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- Following DIV will display FORCE DIRECTED GRAPH-->
	<div class="network" style="float:left; width:100%; position:relative; outline: 0;">
		<div id="openDraw"
			style="font-size:20px;cursor:pointer;display:inline-block; background: rgb(255, 255, 255, 0.3); position:absolute; top: 0px;"
			onclick="openNav()">&#9776; open</div>
		<!-- Open Menu Button-->
	</div>
	<!-- Following DIV will create a LEFT MENU for network filters/modifications features-->
	<div id="mySidenav" class="sidenav">
		<!-- Close Menu Button-->
		<div class="heading" style="word-wrap: normal;">
			<a href="javascript:void(0)" class="closebtn" onclick="closeNav()" style="padding: 0px;">&times;</a>
		</div>
		<div class="legends" style="background: rgb(255, 255, 255, 0.6);">
			<!-- 		
			<label class="btn btn-primary active" data-toggle="tooltip" data-placement="bottom" title="tooltip on radio!">
				<input type="radio" name="options" id="radio1" autocomplete="off">Radio 1
			  </label>
			 -->
			<!-- <button class="accordion active">Disease Map:</button> -->
			<div class="d-inline-flex justify-content-between gap-1 w-100">
				<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleOne" aria-expanded="false" aria-controls="collapseExampleOne">
					Disease Map:<span>+</span>
				</div> -->
				<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleOne" aria-expanded="false" aria-controls="collapseExampleOne">Disease Map:</button>
			</div>
			<!-- <div class="panel" style="max-height:600px;"> -->
			<div class="collapse show" id="collapseExampleOne">
			<div class="b card card-body">
			<!-- <p class="size"> -->
				<div class="size" style="padding:10px 0; max-height:600px;">
					<select id="diseaseMap" name="diseaseMap" style="width:100%; position: relative;
					left: 162px;
					bottom: 22px;" class="chosen-select" onchange="updateTooltip()">
						<option value="ALS">ALS</option>
						<option value="FTD">FTD</option>
						<option value="OI">OI</option>
						<option value="PSP">PSP</option>


					</select>
					<div class="tooltiptext" id="tooltipContainer">
						<span data-toggle="tooltip" data-placement="bottom"
							style="position:relative; left: 160px; bottom: 20px;">
							<img src="../images/icons/info6.png" class="info-image" id="tooltipImage">
							<div class="tooltip-content" id="tooltipContent">Initial Tooltip Text</div>
						</span>
					</div>
				</div>
				<script>
					function updateTooltip() {
						const selectElement = document.getElementById('diseaseMap');
						const selectedText = selectElement.options[selectElement.selectedIndex].text;
						const tooltipContentElement = document.getElementById('tooltipContent');
						const tooltipImageElement = document.getElementById('tooltipImage');

						tooltipContentElement.textContent = getTooltipText(selectedText);
					}

					function getTooltipText(selectedValue) {
						switch (selectedValue) {
							case 'ALS':
								return 'Amyotrophic Lateral Sclerosis.';
							case 'FTD':
								return 'Frontotemporal Dementia.';
							case 'OI':
								return 'Osteogenesis Imperfecta.';
							case 'PSP':
								return 'Progressive Supranuclear Palsy.';
							default:
								return 'Select a disease to see more information.';
						}
					}

					window.onload = updateTooltip;
				</script>
			<!-- </p> -->
		</div>
	  </div>
			
			
			

			<div class="d-inline-flex justify-content-between gap-1 w-100">
				<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
				  Node Color<span>+</span>
				</div> -->
				<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Node Color</button>
			</div>
			  <div class="collapse show" id="collapseExample">
				<div class="b card card-body">
					<p class="size">
						<input type="radio" name="nodeColor" id="none" value="0" checked> None <br>
						<input type="radio" name="nodeColor" id="logFC" value="2">
						logFC
						<span data-toggle="tooltip" data-placement="bottom"
							title="Differential Expression in Log2 fold change.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="GDA" value="9"> GDA
						<span data-toggle="tooltip" data-placement="bottom" title="Gene Disease Association score.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="gwas" value="5"> Genetics
						<span data-toggle="tooltip" data-placement="bottom"
							title="Odd ratio or Beta-values from population studies.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
				
						<input type="radio" name="nodeColor" id="Pathways" value="3">
						Pathways
						<span data-toggle="tooltip" data-placement="bottom" title="Pathway membership from MSigDB.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="Druggability" value="4">
						Druggability
						<span data-toggle="tooltip" data-placement="bottom"
							title="Druggability score from MantisML and Open Target.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="tissue_enh" value="12">
						TE
						<span data-toggle="tooltip" data-placement="bottom"
							title="Tissue-specific expression from GTEX and HPA.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="DBs" value="6">
						Databases
						<span data-toggle="tooltip" data-placement="bottom" title="Membership in various databases.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
						<input type="radio" name="nodeColor" id="custom_color" value="8">
						Custom
						<span data-toggle="tooltip" data-placement="bottom" title="Custom Informations.">
							<img src="../images/icons/info6.png" class="info-image">
						</span>
						<br>
	
					<div>
	
						<div id="logFCInput" class="size" style="padding-bottom:5px;display:none;">
							Select logFC:
							<!-- <div class="panel1" style="max-height:300px;"></div> -->
							<select id="logFCID4Color" name="logFCID4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
	
						</div>
	
						<div id="GDAInput" class="size" style="padding-bottom:5px;display:none;">
							Select GDA:
							<select id="GDAID4Color" name="GDAID4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- Dropdown for GWAS DATA TO highlight nodes-->
						<div id="GWASInput" class="size" style="padding-bottom:5px;display:none;">
							Select Genetics data:
							<select id="GWAS4Color" name="GWAS4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<div id="pathwayInput" class="size" style="padding-bottom:5px;display:none;">
							Select Pathway:
							<select id="pathwayID4Color" name="pathwayID4Color" style="max-width:90%;"
								class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
	
						<div id="druggabilityInput" class="size" style="padding-bottom:5px;display:none;">
							Select Druggability:
							<select id="druggabilityID4Color" name="druggabilityID4Color" style="max-width:90%;"
								class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- Database and assocition dropdown to highlight nodes  -->
						<div id="DBsInput" class="size" style="padding-bottom:5px;display:none;">
							Select significance from databases:
							<select id="DBs4Color" name="DBsID4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<div id="TEInput" class="size" style="padding-bottom:5px;display:none;">
							Select TE Options:
							<select id="TE4Color" name="TE4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
	
						<!-- Direction Dropdown to highlight nodes-->
						<div id="directionInput" class="size" style="padding-bottom:5px;display:none;">
							Select Direction:
							<select id="directionID4Color" name="directionID4Color" style="max-width:90%;">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- Trait dropdown to highlight nodes  -->
						<!-- GWAS_OR_Input -->
						<div id="GWAS_OR_Input" class="size" style="padding-bottom:5px;display:none;">
							Select GWAS OR:
							<select id="GWAS_OR4Color" name="GWAS_OR4Color" style="max-width:90%;">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- GWAS_Beta_Input -->
						<div id="GWAS_Beta_Input" class="size" style="padding-bottom:5px;display:none;">
							Select GWAS Beta:
							<select id="GWAS_Beta4Color" name="GWAS_Beta4Color" style="max-width:90%;">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- celltype markers dropdown to highlight nodes  -->
						<div id="celltypemarkerInput" class="size" style="padding-bottom:5px;display:none;">
							Select celltype markers:
							<select id="markers4Color" name="markers4Color" style="max-width:90%;">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
						<!-- custom color options dropdown to highlight nodes  -->
						<div id="custom_color_input" class="size" style="padding-bottom:5px;display:none;">
							Select Custom Options:
							<select id="custom4Color" name="custom4Color" style="max-width:90%;" class="chosen-select">
								<option value="none" selected="selected">None</option>
							</select>
						</div>
	
					</div>
					</p>
				</div>
			  </div>

			<!-- Node size change button -->
			<!-- <button class="accordion active">Node Size</button> -->
			<div class="d-inline-flex justify-content-between gap-1 w-100">
				<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleTwo" aria-expanded="false" aria-controls="collapseExampleTwo">
					Node Size<span>+</span>
				</div> -->
				<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleTwo" aria-expanded="false" aria-controls="collapseExampleTwo">Node Size</button>
			</div>
			   <div class="collapse show" id="collapseExampleTwo">
				<div class="b card card-body">
				<p class="size">
			<!-- <div class="panel" style="max-height: 300px;margin-left:-20px;" > -->
			<!-- <div class="panel" style="max-height: 300px;">
				<p> -->
					<!-- <button class= "sub_btn">Disease Dependent</button> -->
					<!-- <p class="margin_left"> -->
					<input type="radio" name="nodeSize" id="none" value="0" checked> None <br>
					<input type="radio" name="nodeSize" id="GlogFC" value="1">
					LogFC
					<span  class="tool-tip-font" data-toggle="tooltip" data-placement="bottom"
						title="Differential Expression in Log2 fold change.">
						<img src="../images/icons/info6.png" class="info-image">
					</span>
					<br>
					<input type="radio" name="nodeSize" id="GDA4Size" value="5">
					GDA
					<span class="tool-tip-font" data-toggle="tooltip" data-placement="bottom" title="Gene Disease Association score.">
						<img src="../images/icons/info6.png" class="info-image">
					</span>
					<br>
					<input type="radio" name="nodeSize" id="GWAS4Size" value="3">
					Genetics
					<span class="tool-tip-font" data-toggle="tooltip" data-placement="bottom"
						title="Odd ratio or Beta-values from population studies.">
						<img src="../images/icons/info6.png" class="info-image">
					</span>
					<br>
					<!-- </p> -->
					<!-- <button class= "sub_btn">Disease Independent</button> -->
					<!-- <p class="margin_left"> -->
					<input type="radio" name="nodeSize" id="druggability4Size" value="2">
					Druggability
					<span class="tool-tip-font" data-toggle="tooltip" data-placement="bottom"
						title="Druggability score from MantisML and Open Target.">
						<img src="../images/icons/info6.png" class="info-image">
					</span>
					<br>
					<input type="radio" name="nodeSize" value="4">
					TE
					<span class="tool-tip-font" data-toggle="tooltip" data-placement="bottom"
						title="Tissue-specific expression from GTEX and HPA.">
						<img src="../images/icons/info6.png" class="info-image">
					</span>
					<br>
					<!-- <input type="radio" name="nodeSize" id="STE" value="4"> Tissue Enr. <br>						 -->
					<!-- </p> -->
					<!-- Genomic logFC Dropdown to change the node size-->
				<div>
				 <div id="GlogFCInput4Size" class="size" style="padding-bottom:5px;display:none;">
					Select logFC:
					<select id="GlogFCID4Size" name="GlogFCID4Size" style="max-width:90%;" class="chosen-select">
						<option value="none" selected="selected">None</option>
					</select>
				</div>
				<!----GDAID4Size------>
				<div id="GDAInput4Size" class="size" style="padding-bottom:5px;display:none;">
					Select GDA:
					<select id="GDAID4Size" name="GDAID4Size" style="max-width:90%;" class="chosen-select">
						<option value="none" selected="selected">None</option>
					</select>
				</div>
				<!-- Trait P-values Dropdown to change the node size-->
				<div id="druggabilityInput4Size" class="size" style="padding-bottom:5px;display:none;">
					Select Druggability:
					<select id="druggabilityID4Size" name="druggabilityID4Size" style="max-width:90%;"
						class="chosen-select">
						<option value="none" selected="selected">None</option>
					</select>
				</div>
				<!-- GWAS Dropdown to change the node size-->
				<div id="gwasInput4Size" class="size" style="padding-bottom:5px;display:none;">
					Select Genetics:
					<select id="gwasID4Size" name="gwasID4Size" style="max-width:90%;" class="chosen-select">
						<option value="none" selected="selected">None</option>
					</select>
				</div>

				<div id="TEInput4Size" class="size" style="padding-bottom:5px;display:none;">
					Select TE Options:
					<select id="TE4Size" name="TE4Size" style="max-width:90%;" class="chosen-select">
						<option value="none" selected="selected">None</option>
					</select>
				</div>
			</div>
			</p>
		</div>
	      </div>
			
		</div>
		<!-- Node Shape -->
		<!-- <div class="legends" style="background: rgb(255, 255, 255, 0.6);">
            <button class="accordion active">Node Shape</button>
            
            <div class="panel" style="max-height: 300px;">
            	<p>
            		<input type="radio" name="nodeShape" id="none" value="0" checked> None <br>
            		<input type="radio" name="nodeShape" id="PathwaysShape" value="2"> Pathways <br>
            		<input type="radio" name="nodeShape" id="gwasShape" value="4"> GWAS <br>
            		<input type="radio" name="nodeShape" id="DBsShape" value="5"> Databases <br>
            		<input type="radio" name="nodeShape" id="markersShape" value="6"> Celltype Markers <br>
            
            
            	<div id="pathwayShapeInput" style="padding-bottom:5px;display:none;">
            		Select Pathway:
            		<select id="pathwayID4Shape" name="pathwayID4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            
            	<div id="GWASShapeInput" style="padding-bottom:5px;display:none;">
            		Select GWAS data:
            		<select id="GWAS4Shape" name="GWAS4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            
            	<div id="directionShapeInput" style="padding-bottom:5px;display:none;">
            		Select Direction:
            		<select id="directionID4Shape" name="directionID4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            
            	<div id="traitShapeInput" style="padding-bottom:5px;display:none;">
            		Select Trait:
            		<select id="traitID4Shape" name="traitID4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            
            	<div id="DBsShapeInput" style="padding-bottom:5px;display:none;">
            		Select significance from databases:
            		<select id="DBs4Shape" name="DBsID4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            
            	<div id="celltypemarkerShapeInput" style="padding-bottom:5px;display:none;">
            		Select celltype markers:
            		<select id="markers4Shape" name="markers4Shape" style="max-width:90%;">
            			<option value="none" selected="selected">None</option>
            		</select>
            
            	</div>
            	</p>
            
            </div> -->
		<!-- Radial Analysis -->
		<!-- <button class="accordion active">Radial Analysis</button>
		<div class="panel" style="max-height: 250px;">
			<p> -->
		<div class="d-inline-flex justify-content-between gap-1 w-100">
			<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleThree" aria-expanded="false" aria-controls="collapseExampleThree">
				Radial Analysis<span>+</span>
			</div> -->
			<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleThree" aria-expanded="false" aria-controls="collapseExampleThree">Radial Analysis</button>
		</div>
		<div class="collapse show" id="collapseExampleThree">
		 <div class="b card card-body">
			<p class="size">
				<input type="radio" name="radialAnylisis" id="none" value="0" checked> None <br>
				<input type="radio" name="radialAnylisis" id="EdgeWeightCutOff" value="1"> Edge weight cut-off
				<br>
				<input type="radio" name="radialAnylisis" id="NodeDegree" value="2"> Node cutoff <br>
				<input type="radio" name="radialAnylisis" id="HubGenes" value="3"> Hub genes <br>
				<!-- <input type="radio" name="radialAnylisis" id="stringDBchanal" value="4"> Interaction Type <br> -->
				<!-- Threshold for weight -->
			<div class="slidecontainer" id="EdgeWeightCutOffRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="0" max="1" step=".1" value="0" class="slider" id="myRange">
				<br>
				<p class="size">Edge Weight: <span id="thresh"></span></p>
			</div>
			<!-- node weight dropdown options  -->
			<div id="db4weight" class="slidecontainer" style="padding-bottom:5px;display:none;" class="chosen-select">
				Select Interaction Type:
				<select onchange="changedWeight()" id="stringDBchanal4weight" name="stringDBchanal4weight"
					style="width:100%;">
					<option value="combined_score" selected="selected">Combined score</option>
					<option value="textmining">Textmining</option>
					<option value="experiments">Experiments</option>
					<option value="database">Databases</option>
					<option value="coexpression">Co-expression</option>
					<option value="neighborhood">Neighborhood</option>
					<option value="fusion">Gene Fusion</option>
					<option value="cooccurrence">Co-occurrence</option>
				</select>
			</div>
			<!-- node degree dropdown options  -->
			<div id="nodeDegreeInput4Size" class="slidecontainer size" style="padding-bottom:5px;display:none;">
				Select Node cutoff:
				<select id="nodeDegreeID4Size" name="nodeDegreeID4Size" style="max-width:90%;" class="chosen-select">
					<option value="none" selected="selected">None</option>
					<option value="node_degree">Gene Degree</option>
				</select>
				<!-- Threshold for Degree -->
				<div class="slidecontainer" id="NodeDegreeRange" style="padding-bottom:5px;display:none;">
					<input type="range" min="0" max="20" step="1" value="0" class="slider" id="myDegree">
					<p class="size">node Degree: <span id="thresh1"></span></p>
				</div>
                <!-- Threshold for TE -->
				<div class="slidecontainer" id="TERange" style="padding-bottom:5px;display:none;">
					<input type="range" min="0" max="20" step="0.01" value="0" class="slider" id="myTEvalues" style="margin-top: 10px;">
					<p class="size" style="margin-top: 10px;">TE.: <span id="thresh3"></span></p>
				</div>
			</div>
		
			
			<!-- Threshold for Degree -->
			<!-- <div class="slidecontainer" id="NodeDegreeRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="0" max="20" step="1" value="0" class="slider" id="myDegree">
				<p class="size">node Degree: <span id="thresh1"></span></p>
			</div> -->
			<!-- Gene connections -->
			<div class="slidecontainer" id="HubGenesRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="0" max="50" step="1" value="0" class="slider" id="myConnection">
				<br>
				<p class="size">Hub Node Size: <span id="thresh2"></span></p>
			</div>
			<div id="hub_genes_button_div"></div>
		</p>
	</div>
	  </div>
		<!-- Find node panel-->
		<!-- <button class="accordion">Custom search</button> -->
		<div class="d-inline-flex justify-content-between gap-1 w-100">
			<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleFour" aria-expanded="false" aria-controls="collapseExampleFour">
				Custom search<span>+</span>
			</div> -->
			<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleFour" aria-expanded="false" aria-controls="collapseExampleFour">Custom search</button>
		</div>
		<div class="collapse show" id="collapseExampleFour">
		 <div class="b card card-body">
			<!-- <p class="size"> -->
		<!-- <div class="panel"> -->
			<div class="size" id="geneinput">
				<form name="geneinput">
					<!-- <br> -->
					<p class="size">Find Node<span id="thresh1"></span></p>
					<textarea class="size" rows="2" style="width:90%" id="gene_list" name="gene_list" form="form3"
						placeholder="Enter Genes list (comma seperated)"></textarea>
					<!-- <input id="genesymbol" type="text" value="" name="genesymbol" placeholder="Gene symbol"/> -->
					<input class="size" type="submit" id="submit" value="Submit" />
					<button class="size" type="reset" value="Reset" onclick="resetText()">Reset </button>
					<a id="currentgenesymbol"></a>
				</form>
			</div>
		<!-- </p> -->
	</div>
	  </div>

		<!-- <button class="accordion active">Add Paper</button> -->
		<!-- <button class="accordion active">Custom Upload</button>
		<div class="panel" style="max-height:400px;"> -->
	<div class="d-inline-flex justify-content-between gap-1 w-100">
		<!-- <div class="new d-flex justify-content-between p-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleFive" aria-expanded="false" aria-controls="collapseExampleFive">
			Custom Upload<span>+</span>
		</div> -->
		<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExampleFive" aria-expanded="false" aria-controls="collapseExampleFive">Custom Upload</button>
	</div>
		<div class="collapse show" id="collapseExampleFive">
		 <div class="b card card-body">
			<p class="size">
			<div class="size"style=" margin: 10px">
				<b>Add a file:</b>
				<div id="">
					<input type="file" id="universal_ext" accept="text/csv,.csv">
					<button onclick="universal_ext_update()" style="color: black; margin-top: 5px;">submit</button>
					<button onclick="resetUniversals()" style="color: black; margin-top: 5px;">Reset
						Universal</button>
					<div id="uploading_custom_universal" style="display: none ;margin: 10px 0">Processing...</div>
					<div id="uploaded_custom_universal" style="display: none ;margin: 10px 0">Done</div>
				</div>
			</div>
		   </p>
	     </div>
	   </div>
		<!-- </div> -->

		<!-- Node colors legend-->
		<!-- <button class="accordion">Legends</button>
			<div class="panel" id="legendPanel">
				<p></p>
			</div> -->
		<button id="button_snap" style="outline: 0;" type="button" class="btn btn-default">Take a
			Screenshot!
		</button>
		<script>
			

			/***************  Change network type [Not Implemented yet due to unavailability of data]  ***************

			// Weight Change
			function changedWeight() {
				graph = ""
				$("#loader").css('display', 'block')
				let w = $('#stringDBchanal4weight').val()
				let d = JSON.parse(getItemFromStorage('pd_net_stringDB'));
				console.log(d)
				d.analysedWeight = w;
				// localStorage.setItem('pd_net_stringDB', JSON.stringify(d));
				setItemToStorage('pd_net_stringDB', JSON.stringify(d));

				$.ajax({
					url: `${URLs()}/get/network/fromNodes`,
					type: "POST",
					dataType: 'json',
					data: d,
					success: function (result) {
						$("#loader").css('display', 'none')
						startD3(result);
						// force.start();
					},
					error: function (err) {
						$("#loader").css('display', 'none')
						alert(err.responseJSON.message ? err.responseJSON.message : "There is an issue. Please try after some time");
						// window.location.href = '/pdnet';
					}
				});

			}
			
			*/

			var width = 1280,
				height = 720;
			// function takesnapshot() {
			d3.select('#button_snap').on('click', function () {
				jQuery('#button_snap').html('loading ...');
				$('#button_snap').css('background', 'transparent');
				$('#button_snap').css('pointer-events', 'none');
				$('#button_snap').css('border', 'none');
				var svgString = getSVGString(svg.node());
				svgString2Image(svgString, 10 * width, 10 * height, 'png',
					save); // passes Blob and filesize String to the callback

				function save(dataBlob, filesize) {
					console.log('BLOB', dataBlob, jsonFile)
					jQuery('#button_snap').html('Take a Screenshot!');
					jQuery('#button_snap').css('background', 'white');
					$('#button_snap').css('pointer-events', 'all');
					// $('#button_snap').append("Take a Screenshot!")
					saveAs(dataBlob, `${'savethis'}.png`); // FileSaver.js function
				}
			});

			function getSVGString(svgNode) {
				svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');
				var cssStyleText = getCSSStyles(svgNode);
				appendCSS(cssStyleText, svgNode);

				var serializer = new XMLSerializer();
				var svgString = serializer.serializeToString(svgNode);
				svgString = svgString.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace
				svgString = svgString.replace(/NS\d+:href/g, 'xlink:href'); // Safari NS namespace fix

				return svgString;

				function getCSSStyles(parentElement) {
					var selectorTextArr = [];

					// Add Parent element Id and Classes to the list
					selectorTextArr.push('#' + parentElement.id);
					for (var c = 0; c < parentElement.classList.length; c++)
						if (!contains('.' + parentElement.classList[c], selectorTextArr))
							selectorTextArr.push('.' + parentElement.classList[c]);

					// Add Children element Ids and Classes to the list
					var nodes = parentElement.getElementsByTagName("*");
					for (var i = 0; i < nodes.length; i++) {
						var id = nodes[i].id;
						if (!contains('#' + id, selectorTextArr))
							selectorTextArr.push('#' + id);

						var classes = nodes[i].classList;
						for (var c = 0; c < classes.length; c++)
							if (!contains('.' + classes[c], selectorTextArr))
								selectorTextArr.push('.' + classes[c]);
					}

					// Extract CSS Rules
					var extractedCSSText = "";
					for (var i = 0; i < document.styleSheets.length; i++) {
						var s = document.styleSheets[i];

						try {
							if (!s.cssRules) continue;
						} catch (e) {
							if (e.name !== 'SecurityError') throw e; // for Firefox
							continue;
						}

						var cssRules = s.cssRules;
						for (var r = 0; r < cssRules.length; r++) {
							if (contains(cssRules[r].selectorText, selectorTextArr))
								extractedCSSText += cssRules[r].cssText;
						}
					}


					return extractedCSSText;

					function contains(str, arr) {
						return arr.indexOf(str) === -1 ? false : true;
					}

				}

				function appendCSS(cssText, element) {
					var styleElement = document.createElement("style");
					styleElement.setAttribute("type", "text/css");
					styleElement.innerHTML = cssText;
					var refNode = element.hasChildNodes() ? element.children[0] : null;
					element.insertBefore(styleElement, refNode);
				}
			}


			function svgString2Image(svgString, width, height, format, callback) {
				var format = format ? format : 'png';

				var imgsrc = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(
					svgString))); // Convert SVG string to data URL

				var canvas = document.createElement("canvas");
				var context = canvas.getContext("2d");

				canvas.width = width;
				canvas.height = height;

				var image = new Image();
				image.onload = function () {
					context.clearRect(0, 0, width, height);
					context.drawImage(image, 0, 0, width, height);

					canvas.toBlob(function (blob) {
						var filesize = Math.round(blob.length / 1024) + ' KB';
						if (callback) callback(blob, filesize);
					});


				};
				console.log(imgsrc);
				image.src = imgsrc;
			}
			// }
		</script>
		<!-- <button class="reset-all-btn">Reset All</button> -->
		<!-- network setting page -->
		<!-- Select node panel-->
		<!-- <button class="accordion">Selected Node</button>
            <div class="panel" id="sgeneinput">
               <p>
              <div id="sgeneinput1">
              <textarea rows="2" style="width:90%" id="sgene_list" name="sgene_list" placeholder="Nothing selected"></textarea>
              </div></p>
            </div>
            <div class="resetBtn">
            	<button type="reset" value="Reset" onclick="resetText()" style="margin:auto;display:block; box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);" >Reset the network </button>
            </div> -->
		<!--button type="reset" value="Reset" onclick="resetText()" >Reset </button-->
		<!-- <div class="resetBtn">
            <button type="reset" value="Reset" onclick="resetText()"
            	style="margin:auto;display:block; box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);">Reset
            	the network </button>
            </div> -->
	</div>
	</div>
	<div class="setting_wrapper" id="mysetting" style="display: none">
		<div class="setting_close">
			close
			<a href="javascript:void(0)" class="closebtn" onclick="closeSetting()" style="padding: 0px;">&times;</a>
		</div>
		<!-- // gravity .1
         // distance  infinity
         //  chargeDistance infinity
         // linkStrength 1
         // theta .8 -->
		<!-- <button class="accordion active">Network layout</button> -->
		<div class="d-inline-flex justify-content-between gap-1 w-100">
			<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRightOne" aria-expanded="false" aria-controls="collapseRightOne">Network layout</button>
		</div>
		<!-- <div class="panel" style="max-height: 202px;"> -->
		<div class="collapse show" id="collapseRightOne">
		  <div class="b card card-body">
			<p class="size">
				<input type="radio" name="force_setting" id="none" value="0" checked> None <br>
				<input type="radio" name="force_setting" id="link_distance" value="1"> Link Distance<br>
				<input type="radio" name="force_setting" id="charge" value="2"> Link Charge <br>
				<input type="radio" name="force_setting" id="link_Strength" value="3"> Distance<br>
			<p class="size">
				<button onclick="stopAnimation()" style="color: black">Stop Animation</button>
			</p>
			<!-- <input type="radio" name="force_setting" id="gravity" value="3"> Link Distance<br>
                <input type="radio" name="force_setting" id="theta" value="1"> Link Distance<br> -->
			<!-- Threshold for weight -->
			<div class="forcecontainer" id="linkdistanceRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="1" max="100" step="1" value="0" class="slider" id="linkdistance">
				<br>
				<p class="size">link distance: <span id="linkdistanceinput"></span></p>
			</div>
			<!-- Threshold for Degree -->
			<div class="forcecontainer" id="linkchargeRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="-300" max="50" step="1" value="-200" class="slider" id="linkcharge">
				<br>
				<p class="size">node charge: <span id="linkchargeinput"></span></p>
			</div>
			<div class="forcecontainer" id="linkStrengthRange" style="padding-bottom:5px;display:none;">
				<input type="range" min="1" max="1000" step="10" value="1" class="slider" id="linkStrength">
				<br>
				<p class="size">distance: <span id="linkStrengthinput"></span></p>
			</div>
			<!-- <button type="reset" value="Reset" class="networklayoutreset" onclick="resetLayout()">Reset
				</button> -->
			<!-- Gene connections -->
			</p>
		</div>
		</div>
		<!-- <button class="accordion active">Network parameters</button> -->
		<!-- <div class="panel" style="max-height:400px;"> -->
			<!-- <p> -->
		<div class="d-inline-flex justify-content-between gap-1 w-100">
			<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRightTwo" aria-expanded="false" aria-controls="collapseRightTwo">Network parameters</button>
		</div>
		
		<div class="collapse show" id="collapseRightTwo">
		  <div class="b card card-body">
			<p class="size">
				<input type="radio" name="network_parameters" id="none" value="0" checked> None <br>
				<input type="radio" name="network_parameters" id="nodecolor" value="1"> Node Color Change<br>
				<input type="radio" name="network_parameters" id="linkcolor" value="2"> Link Color Opacity<br>
				<input type="radio" name="network_parameters" id="linkcolor" value="3"> Node Size<br>
				<input type="radio" name="network_parameters" id="linkcolor" value="4"> Text Size<br>
				<!-- <input type="radio" name="network_parameters1" id="nodecolor1" value="6"> Highlight Seed Genes<br>
				<input type="radio" name="network_parameters" id="linkColor1" value="7"> Show Edge Color<br> -->
               
				<!-- <input type="radio" name="network_parameters" id="nodeColor" value="5"> Text Size<br> -->
				<!-- <input type="radio" name="network_parameters" id="linkcolor" value="5"> Network Zoom<br> -->
				<!-- <input type="radio" name="force_setting" id="gravity" value="3"> Link Distance<br>
               <input type="radio" name="force_setting" id="theta" value="1"> Link Distance<br> -->
				<!-- Threshold for weight -->
			<div class="networkcontainer" id="color_range" style="padding-bottom:5px;display:none;">
				<div class="colorParam" id="color_ouput" style="background: rgb(23,190,207)"></div>
				<p class="size">color R: <span id="rRange">23</span></p>
				<input type="range" min="0" max="255" step="1" value="23" class="slider" id="redRange"
					onchange="colorFinc()">
				<br>
				<p class="size">color G: <span id="gRange">190</span></p>
				<input type="range" min="0" max="255" step="1" value="190" class="slider" id="greenRange"
					onchange="colorFinc()">
				<br>
				<p class="size">color B: <span id="bRange">207</span></p>
				<input type="range" min="0" max="255" step="1" value="207" class="slider" id="blueRange"
					onchange="colorFinc()">
			</div>
			<div class="networkcontainer" id="opacity_range" style="padding-bottom:5px;display:none;">
				<p class="size">opacity: <span id="oRange">1</span></p>
				<input type="range" min="0" max="1" step=".1" value="1" class="slider" id="opacityRange"
					onchange="opacityFunc()">
			</div>
			<div class="networkcontainer" id="node_size" style="padding-bottom:5px;display:none;">
				<p class="size">node size: <span id="nRange">8</span></p>
				<input type="range" min="8" max="15" step="1" value="8" class="slider" id="nodeRange"
					onchange="nodeSizeFunc()">
			</div>
			<div class="networkcontainer" id="text_size" style="padding-bottom:5px;display:none;">
				<p class="size">text size: <span id="tRange">8</span></p>
				<input type="range" min="2" max="15" step="1" value="8" class="slider" id="textRange"
					onchange="textSizeFunc()">
				<!--CHANGE IS NEEDED-->
			</div>
			<!-- <div class="networkcontainer" id="zoom_network" style="padding-bottom:5px;display:none;">
            <button class="zoom_btn" id="zoom_in">+</button>
            <button class="zoom_btn" id="zoom_out">-</button>
            
            
			 Threshold for Degree -->
			<!-- <div class="forcecontainer" id="linkchargeRange" style="padding-bottom:5px;display:none;">
            <input type="range" min="-300" max="50" step="1" value="-200" class="slider" id="linkcharge">
            <br>
            <p>node charge: <span id="linkchargeinput"></span></p>
            </div>
            
            <div class="forcecontainer" id="linkStrengthRange" style="padding-bottom:5px;display:none;">
            <input type="range" min="1" max="1000" step="10" value="1" class="slider" id="linkStrength">
            <br>
            <p>distance: <span id="linkStrengthinput"></span></p>
            </div> -->
			<!-- <button type="reset" value="Reset" class="networklayoutreset" onclick="reset_param()">Reset
            </button> -->
			<!-- Gene connections -->
			</p>
		  </div>
		</div>
		<div class="d-inline-flex justify-content-between gap-1 w-100">
			<button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRightFour" aria-expanded="false" aria-controls="collapseRightFour">Highlight Node/Edge Color</button>
		</div>
		
		<div class="collapse show" id="collapseRightFour">
		  <div class="b card card-body">
			<p class="size">
				<input type="checkbox" name="highlight_seedEdge" id="nodecolor1" value="6" style="margin-top: 10px;" checked> Highlight Seed Genes<br>
                <input type="checkbox" name="highlight_seedEdge" id="linkColor1" value="7" style="margin-top: 10px;"> Show Edge Color<br>

			</p>
		</div>
	  </div>

		<!-- <button class="accordion active">Annotations</button>
		<div class="panel" style="max-height:200px;"> -->
		<div class="d-inline-flex justify-content-between gap-1 w-100">
		 <button class="accordion active" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRightThree" aria-expanded="false" aria-controls="collapseRightThree">Annotations</button>
		</div>
		<div class="collapse show" id="collapseRightThree">
		  <div class="b card card-body">
			<div class="size" id="gene_info"></div>
		</div>
		</div>

		<div style="margin: 10px">
			<b class="size">NETWORK INFO:</b>
			<div id="network_details">
			</div>
		</div>
		<!-- <button class="accordion active">Add Paper</button>
		<div class="panel" style="max-height:400px;">
			<div style="margin: 10px">
				<b>Add a file:</b>
				<div id="">
					<input type="file" id="universal_ext" accept="text/csv,.csv">
					<button onclick="universal_ext_update()" style="color: black; margin-top: 5px;">submit</button>
					<button onclick="resetUniversals()" style="color: black; margin-top: 5px;">Reset Universal</button>
					<div id="uploading_custom_universal" style="display: none ;margin: 10px 0">Processing...</div>
					<div id="uploaded_custom_universal" style="display: none ;margin: 10px 0">Done</div>
				</div>
			</div>
		</div> -->
		<!-- Node colors legend 2-->

		<button class="accordion">Legends</button>
		<div class="panel" id="legendPanel">
			<p></p>
		</div>

	</div>
	</div>
	<div class="networksetting">
		<h4 onclick="settingFunc()">Setting &#x2699; </h4>
	</div>
	<script>
			
		// clear universal data
		function clearUniData() {
			// GWAS4Color vandana
			document.getElementById('pathwayID4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('GWAS4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('logFCID4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('directionID4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('druggabilityID4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('DBs4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('markers4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('custom4Color').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('GlogFCID4Size').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('druggabilityID4Size').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('gwasID4Size').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('TE4Size').innerHTML = `<option value="none" selected="selected">None</option>`;
			document.getElementById('GDAID4Size').innerHTML = `<option value="none" selected="selected">None</option>`;
		}

		// Reset universal
		function resetUniversals() {
			resetText()
			clearUniData()
			$("#diseaseMap").val(JSON.parse(getItemFromStorage('pd_net_stringDB')).disease);
			$("#diseaseMap option[value='Custom Universal']").remove();
			getUniversal(initialUniversal);
		}
		// new value to universal file
		function universal_ext_update() {
			let file = document.getElementById('universal_ext')?.files[0];
			if (!file) {
				alert('No file found!');
				return;
			}
			$('#uploading_custom_universal').css('display', 'block');
			const reader = new FileReader();
			reader.onload = function (e) {
				const csvData = e.target.result;
				let nodePropertyHeaders = ["logFC_", "direction_", "pathway_", "CellType_", "pvalue_", "Druggability_", "GWAS_", "GWAS_OR_", "GWAS_Beta_", "database_", "custom_color_", "relevence_", "GDA_", "TE_"];
				let csvFormattedData = $.csv.toObjects(csvData);
				csvFormattedData = csvFormattedData.map(obj => Object.keys(obj).reduce((acc, key) => {
					acc[key.trim()] = obj[key].trim();
					return acc;
				}, {}));
				const headers = Object.keys(csvFormattedData[0]).filter(header => nodePropertyHeaders.some(prop => header.toLowerCase().startsWith(prop.toLowerCase())));
				csvFormattedData.forEach((gene, idx) => {
					currentUniversal.genes[geneIndexMap[gene.ID]] = {
						...headers.reduce((obj, key) => {
							obj[key] = gene[key];
							return obj;
						}, {}),
						...currentUniversal.genes[geneIndexMap[gene.ID]]
					}
				});
				$("#diseaseMap").append(`<option value="Custom Universal">Custom Universal</option>`);
				$("#diseaseMap").val('Custom Universal');
				document.getElementById("universal_ext").value = "";
				clearUniData();
				getUniversal(currentUniversal, headers);
				$('#uploading_custom_universal').css('display', 'none');
				$('#uploaded_custom_universal').css('display', 'block');
				setTimeout(() => {
					$('#uploaded_custom_universal').css('display', 'none');
				}, 2000)
			}
			reader.readAsText(file);
		}
		function closeAlert() {
			$("#node-modal-background-alert").css("display", "none");
		}

		function closeModal() {
			$("#node-modal-background").css("display", "none");
		}

		function closeModalHUB() {
			$("#node-modal-background-2").css("display", "none");
		}


		//Open left menu function
		function openNav() {
			document.getElementById("mySidenav").style.width = "250px";
			document.getElementById("openDraw").style.display = "none";
		}

		//Close left menu function
		function closeNav() {
			document.getElementById("mySidenav").style.width = "0";
			document.getElementById("openDraw").style.display = "block";
		}

		// Close setting drawer
		function closeSetting() {
			document.getElementById("mysetting").style.display = "none";
			$('.networksetting').css('top', '0px')
			// document.getElementsByClassName("networksetting").style.display = "block";
		}

		//Capitalize first letter
		window.jsUcFirst = function (string) {
			return string.charAt(0).toUpperCase() + string.slice(1);
		}

		//Handling left menu hight
		var acc = document.getElementsByClassName("accordion");
		var i;
		for (i = 0; i < acc.length; i++) {
			acc[i].addEventListener("click", function () {
				this.classList.toggle("active");
				var panel = this.nextElementSibling;
				if (panel.style.maxHeight) {
					panel.style.maxHeight = null;
				} else {
					panel.style.maxHeight = 600 + "px";
				}
			});
		}

		//Reset "find Node" box as well network to its previous stage
		function resetText() {
			$("#gene_list").val('');
			$("#logFCID4Color").val('none')
			$("#directionID4Color").val('none')
			$("#pathwayID4Color").val('none');
			d3.select("#druggabilityInput4Size").style("display", "none");
			d3.select("#PlogFCInput").style("display", "none");
			d3.select("#GlogFCInput4Size").style("display", "none");
			d3.select("#gwasInput4Size").style("display", "none");
			d3.select("#GDAInput4Size").style("display", "none");
			d3.select("#TE4Color").style("display", "none");
			// console.log($("#logFCID4Color").val());
			$("input[name='nodeColor']")[0].checked = true; // rectified nodecolor

			$("input[name='nodeSize']")[0].checked = true; // rectified nodesize
			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					.size(function (d) {
						return Math.PI * Math.pow(nominal_base_node_size, 2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));

			if ($("input[name='nodeColor']:checked").val() == 3) {
				//$("input[name='nodeColor']:checked").trigger('change');
				$("#pathwayID4Color option:selected").trigger('change');
			} else {
				$("input[name='nodeColor']:checked").trigger('change');
				//$("#pathwayID4Color option:selected").trigger('change');

			}
			//$(".country option:selected")
		}
	</script>
	<script>
		var jsonFile;
		var nodeSize;
		var hubGenesArray = []

		//Get JSON file name received through get method
		function processUser() {
			var parameters = location.search.substring(1).split("&");
			var temp = parameters[0].split("=");
			jsonFile = unescape(temp[1]);
			var heading = jsonFile.split(".");
			d3.select("body").selectAll(".heading").selectAll("h5").remove("*");
			d3.select("body").selectAll(".heading").append("h5").style("word-wrap", "break-word").text('custom');
		}
		processUser();

		//Get Quartile of array of values
		function quartileBounds(_sample) {
			// find the median as you did
			var _median = math.median(_sample)

			// split the data by the median
			var _firstHalf = _sample.filter(function (f) {
				return f < _median
			})
			var _secondHalf = _sample.filter(function (f) {
				return f >= _median
			})

			// find the medians for each split
			var _25percent = math.median(_firstHalf);
			var _75percent = math.median(_secondHalf);
			var iqr = _75percent - _25percent;

			var lowerBound = _25percent - (1.5 * iqr)
			var upperBound = _75percent + (1.5 * iqr)

			// this will be the upper bounds for each quartile
			return [lowerBound, upperBound, _25percent, _75percent];
		}


		// returns [26,33,78.5,288]

		//get window width and height
		var w = window.innerWidth;
		var h = window.innerHeight;

		var keyc = true,
			keys = true,
			keyt = true,
			keyr = true,
			keyx = true,
			keyd = true,
			keyl = true,
			keym = true,
			keyh = true,
			key1 = true,
			key2 = true,
			key3 = true,
			key0 = true

		var focus_node = null,
			highlight_node = null;

		var text_center = false;
		var outline = false;

		var min_score = 0;
		var max_score = 1;

		//linear scale for coloring nodes
		/*var color = d3.scale.linear()
		  .domain([min_score, (min_score+max_score)/2, max_score])
		  .range(["lime", "yellow", "red"]); */



		var highlight_color = "blue";
		var highlight_trans = 0.1;

		var xScale = d3.scale.linear()
			.domain([0, w]).range([0, w]);
		var yScale = d3.scale.linear()
			.domain([0, h]).range([0, h]);
		//Node size scale
		var size = d3.scale.pow().exponent(1)
			.domain([50, 200])
			.range([10, 30]);

		//Define force layout
		// console.log(d3.layout.force().distance())
		var force = d3.layout.force()
			.linkDistance(15)
			.charge(-200)
			.size([w, h]);
		// gravity .1
		// distance  infinity
		//  chargeDistance infinity
		// linkStrength 1
		// theta .8

		//deferent variables used in plot generation
		var nodeSize_sel = "";
		var nodeColor_sel = "";
		var default_node_color = "rgb(23, 190, 207)"; //#17becf
		//var default_node_color = "rgb(3,190,100)";
		//var default_link_color = "#888";
		var default_link_color = "#c5c5c5";
		var nominal_base_node_size = 8;
		var nominal_text_size = 8;
		var nominal_text_size_hovar = 15;
		var max_text_size = 10;
		var max_text_size_hovar = 15;
		var nominal_stroke = 1;
		var max_stroke = 4.5;
		var max_base_node_size = 25;
		var max_base_node_size1 = 200;
		var min_base_node_size = 50;
		var min_zoom = 0.1;
		var max_zoom = 7;
		var svg = d3.select("body").selectAll(".network").attr("tabindex", 1).on("keydown.brush", keydown)
			//var svg = d3.select("body").selectAll(".network").attr("tabindex", 1)
			.on("keyup.brush", keyup).each(function () {
				this.focus();
			}).append("svg");

		var zoom = d3.behavior.zoom().scaleExtent([min_zoom, max_zoom])
		var zoomer = d3.behavior.zoom().
			scaleExtent([min_zoom, max_zoom]).
			x(xScale).
			y(yScale).
			on("zoomstart", zoomstart).
			on("zoom", redraw);

		function zoomstart() {
			node.selectAll("path").each(function (d) {
				d.selected = false;
				d.previouslySelected = false;
			});
			node.selectAll("path").classed("selected", false);
		}

		function redraw() {
			vis.attr("transform",
				"translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")");
			//console.log("zoom")
			var text_size = nominal_text_size;
			//var text_size_hovar = nominal_text_size_hovar;
			// console.log('TEXT CHECK ->>', nominal_text_size, zoomer.scale(), max_text_size, '<<----'); // rectify
			// console.log('nominal_text_size',nominal_text_size);
			// console.log('zoomer.scale()', zoomer.scale());
			// console.log('max_text_size', max_text_size);
			// console.log('text_size', text_size, '\n\n');


			if (nominal_text_size * zoomer.scale() > max_text_size) text_size = max_text_size / zoomer.scale();

			//if (nominal_text_size_hovar*zoom.scale()>max_text_size_hovar) text_size_hovar = max_text_size_hovar/zoom.scale();
			// text.style("font-size", text_size + "px"); // rectified , just commented out this line	

			// console.log('text_size', text_size, '\n\n');

			nominal_text_size_hovar * zoom.scale() > max_text_size_hovar ? text_size = max_text_size_hovar :
				nominal_text_size_hovar * zoom.scale() < nominal_text_size_hovar ? text_size = nominal_text_size_hovar :
					text_size = nominal_text_size_hovar * zoom.scale();
			//text.style("font-size",text_size + "px");
			//text.style("font-size","5px");
			gbTootip.style("font-size", text_size + "px"); // rectify

			vis.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
		}
		//var g = svg.append("g");
		svg.style("cursor", "move");
		var graph = {};
		var expressionColor, nodeSizeScale, nodeSizeScaleFC, nodeSizeScalePval, shiftKey, ctrlKey;
		var uniNode = {};
		var link;
		var node;

		// Node tool-tip
		var gbTootip = d3.select("body") // rectify
			.append("div")
			.attr("class", "gtip")
			.style("background", "#FFFFE0")
			.style("color", "black")
			.style("padding", "10px")
			.style("border-radius", "5px")
			.style("position", "absolute")
			.style("display", "none")
			.style("font-size", "15px")
			.style("box-shadow", "rgb(0 0 0 / 75%) 0px 0px 28px -7px")
			.style("border", "1px solid rgb(204, 204, 204)")
			//.style("max-width", "200px")
			.on("mouseover", function () {
				gbTootip.transition().duration(0);
			})
			.on("mouseout", function () {
				gbTootip.style("display", "none");
			});

		function getTooltipHtml(d) {
			var html = '';
			for (fname in d) {
				html += fname + ':&nbsp;' + d[fname] + '<br>';

			}
			return html.trim('<br>');
		}

		function stopAnimation() {
			force.stop();
		}

		function clearSelectedNode() {
			nodeDetails = [];
			gene_info.innerHTML = "";
			tableInfo.innerHTML = "";
		}

		function showModal() {
			$('#table_data-ip').animate({
				scrollTop: 0
			}, 500);
			$("#node-modal-background").css("display", "block");
			$("#node-modal-background").css("display", "flex");
			$("#node-modal-background").css("flex-direction", "row");
		}

		function showModalHUB() {
			$('#table_data-ip-2').animate({
				scrollTop: 0
			}, 500);
			$("#node-modal-background-2").css("display", "block");
			$("#node-modal-background-2").css("display", "flex");
			$("#node-modal-background-2").css("flex-direction", "row");
		}

		var brusher = d3.svg.brush()
			.x(xScale)
			.y(yScale)
			.on("brushstart", function (d) {
				node.selectAll("path").each(function (d) {
					//console.log(d)
					d.previouslySelected = shiftKey && d.selected;
				});
			})
			.on("brush", function () {
				var extent = d3.event.target.extent();

				node.selectAll("path").classed("selected", function (d) {

					return d.selected = d.previouslySelected ^
						(extent[0][0] <= d.x && d.x < extent[1][0] &&
							extent[0][1] <= d.y && d.y < extent[1][1]);
				});
			})

			.on("brushend", function () {
				d3.event.target.clear();
				d3.select(this).call(d3.event.target);
				//########################
				let x = [];
				let nodeDetails = []; // NEW ADDED
				d3.selectAll('.node').each(function (d) {
					if (d.selected) {
						nodeDetails.push(d);
					}
				});
				let gInfo = document.getElementById("gene_info");
				let tableInfo = document.getElementById("table_data-ip");
				// on mouse select of single or multi nodes
				d3.selectAll('.node')
					.each(function (d) {
						if (d.selected) {
							// let gInfo = document.getElementById("gene_info");
							// let tableInfo = document.getElementById("table_data-ip");
							gene_info.innerHTML = "";
							tableInfo.innerHTML = "";
						}
					});
				nodeDetails.forEach((i, index) => {
					$("#gene_info").append(`<p>${i.Gene_name}</p>`)
					$("#table_data-ip")
						.append(`<tr>
      				  	<td style="width: 50px; padding: 5px;">${index + 1}.</td>
      					<td>${i.Gene_name}</td>
      					<td>${i.ID}</td>
      					<td style="width: 360px">${i.Description == undefined ? 'No description found' : i.Description}</td>
      				</tr>`);
				});
				$("#gene_info").append(
					`<button onclick="showModal()" style=" margin: 10px 0px;padding: 5px 10px; color: black; float: left">Node Details</button>`
				);
				$("#gene_info").append(
					`<button onclick="clearSelectedNode()" style=" margin: 10px 0px;padding: 5px 10px; color: black; float: left">Clear</button>`
				)
				$("#gene_info").append(`<div style="float: left; margin-bottom: 10px">${nodeDetails.length} nodes selected</div>`);
				// }
				// }); // NEW ADDED
				$('#sgene_list').val(x.toString())
			});

		var svg_graph = svg.append('svg:g').call(zoomer);

		var rect = svg_graph.append('svg:rect')
			.attr('width', w)
			.attr('height', h)
			.attr('fill', 'transparent')
			//.attr('opacity', 0.5)
			.attr('stroke', 'transparent')
			.attr('stroke-width', 1)
			//.attr("pointer-events", "all")
			.attr("id", "zrect")

		var brush = svg_graph.append("g")
			.datum(function () {
				return {
					selected: false,
					previouslySelected: false
				};
			})
			.attr("class", "brush");

		var vis = svg_graph.append("svg:g");

		vis.attr('id', 'vis')
		//.attr('fill', 'red')
		//.attr('stroke', 'black')
		//.attr('stroke-width', 1)
		//.attr('opacity', 1)



		brush.call(brusher)
			.on("mousedown.brush", null)
			.on("touchstart.brush", null)
			.on("touchmove.brush", null)
			.on("touchend.brush", null);

		brush.select('.background').style('cursor', 'auto')
			.on("click", function (d) {
				$('#sgene_list').val("");
			});


		function dragended(d) {
			//d3.select(self).classed("dragging", false);
			node.selectAll("path").filter(function (d) {
				return d.selected;
			})
				.each(function (d) {
					d.fixed &= ~6;
				})

		}

		function startD3(data) {
			graph = JSON.parse(JSON.stringify(data));
			graph.links = graph.links.map(d => ({
				source: +d.gene1.index,
				target: +d.gene2.index,
				weight: +d.score
			}));
			graph.genes = graph.genes.map(d => ({			
				ID: d?.ID,
				Gene_name: d?.Gene_name,
				Description: d?.Description,
				hgnc_gene_id: d?.hgnc_gene_id,
				hgnc_gene_symbol: d?.hgnc_gene_symbol,
			}));
			graphRec = JSON.parse(JSON.stringify(graph)); //Add this line			
			var nodSize = [];

			//Node size scales for genomic and proteomic logfc

			nodeSizeScaleFC = d3.scale.linear()
				.domain([1, 4])
				.range([min_base_node_size, max_base_node_size1]);

			nodeSizeScalePval = d3.scale.linear()
				.domain([1, 11])
				.range([min_base_node_size, max_base_node_size]);

			nodeSizeScale = nodeSizeScaleFC;

			/*
			expressionColor = d3.scale.linear()
						.domain([nodeSizeMin, 0, nodeSizeMax])
						.range(["green", default_node_color, "red"]);
			*/

			//Node color scale for linear color range

			expressionColor = d3.scale.linear()
				.domain([-1.5, 0, +1.5])
				.range(["green", default_node_color, "red"]);


			//Store true if two nodes have connection
			var linkedByIndex = {};
			graph.links.forEach(function (d) {
				linkedByIndex[d.source + "," + d.target] = true;
			});

			//Check if two nodes are connected or not
			function isConnected(a, b) {
				return linkedByIndex[a.index + "," + b.index] || linkedByIndex[b.index + "," + a.index] || a.index ==
					b.index;
			}

			//Check if a node has connection/s
			function hasConnections(a) {
				for (var property in linkedByIndex) {
					s = property.split(",");
					if ((s[0] == a.index || s[1] == a.index) && linkedByIndex[property]) return true;
				}
				return false;
			}

			//Start the node directed graph
			force
				.nodes(graph.genes)
				.links(graph.links)
				.start();

			//create edges between node
			link = vis.selectAll(".link")
				//link = g.selectAll(".link")
				.data(graph.links)
				.enter().append("line")
				.attr("class", "link")
				.style("stroke-width", nominal_stroke)
				.style("stroke", function (d) {
					 if (isNumber(d.weight) && d.weight <= 0) return "red"; // initialize with red if weight is 0
					// else if (isNumber(d.weight) && d.weight > 0.5) return "green"; // color
					 else return default_link_color;
				})

			function dragstarted(d) {
				d3.event.sourceEvent.stopPropagation();
				if (!d.selected && !shiftKey) {
					// if this node isn't selected, then we have to unselect every other node
					node.selectAll("path").classed("selected", function (p) {
						return p.selected = p.previouslySelected = false;
					});
				}

				d3.select(this).classed("selected", function (p) {
					d.previouslySelected = d.selected;
					return d.selected = true;
				});

				node.selectAll("path").filter(function (d) {
					return d.selected;
				})
					.each(function (d) {
						d.fixed |= 2;
					})
			}

			function dragged(d) {
				node.selectAll("path").filter(function (d) {
					return d.selected;
				})
					.each(function (d) {
						d.x += d3.event.dx;
						d.y += d3.event.dy;

						d.px += d3.event.dx;
						d.py += d3.event.dy;
					})

				// force.resume();
			}

			//Gradient in nodes to give 3D effects
			grads = svg.append("defs").selectAll("radialGradient")
				.data(graph.genes)
				.enter()
				.append("radialGradient")
				.attr("gradientUnits", "objectBoundingBox")
				.attr("cx", 0)
				.attr("cy", 0)
				.attr("r", "100%")
				.attr("id", function (d, i) {
					if (d.Gene_name == null) return "grad" + i;
					genID = d.Gene_name.replace("-", "HYPHEN")
					genID = genID.replace(".", "DOT")
					genID = genID.replace("(", "LB")
					genID = genID.replace(")", "RB")
					genID = genID.replace(/[^A-Za-z0-9]/g, '')
					//genID = genID.replace(/\s/, "")
					genID = d.ID + "_" + genID;
					return genID;
				});
			//.attr("id", function(d, i) { return "grad" + i; });

			//Set white & blue color for gradient 3D effects
			grads.append("stop")
				.attr("offset", "0%")
				.style("stop-color", "white");

			grads.append("stop")
				.attr("offset", "100%")
				.style("stop-color", function (d) {
					return default_node_color;
				});


			//Create node container g
			node = vis.selectAll(".node")
				.data(graph.genes)
				.enter().append("g")
				.attr("class", "node")
				.attr("id", function (d, i) {
					//console.log(d.ID);
					//genID = d.Gene_name.replace("-", "HYPHEN")
					//genID = genID .replace(".", "DOT")
					//genID = d.ID+"_"+genID;
					genID = d.ID;
					return genID;
				})
			//.call(force.drag)

			//double click on a node to make it on center of the page
			node.on("dblclick.zoom", function (d) {
				d3.event.stopPropagation();

				var dcx = (window.innerWidth / 2 - d.x * zoom.scale());
				var dcy = (window.innerHeight / 2 - d.y * zoom.scale());
				zoom.translate([dcx, dcy]);
				vis.attr("transform", "translate(" + dcx + "," + dcy + ")scale(" + zoom.scale() + ")");
			});


			var tocolor = "fill";
			var towhite = "stroke";
			if (outline) {
				tocolor = "stroke"
				towhite = "fill"
			}


			//Define the node size (in this case circle)
			var circle = node.append("path")
				.attr("d", d3.svg.symbol()
					.size(function (d) {
						//if($('input[name=nodeSize]:checked').val() == 1)
						//{
						thisNodeSize = size(nodeSizeScale(Math.pow(2, Math.abs(Number(d[nodeSize])))));
						//thisNodeSize = size(nodeSizeScale(Math.abs(Number(d[nodeSize]))));
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
						/*}
						else if($('input[name=nodeSize]:checked').val() == 2)
						{
							return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d.proteomics_fc))))) || nominal_base_node_size,2);
						}
						else
						{
							return Math.PI*Math.pow(nominal_base_node_size,2);
						}*/

					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}))
				.style("fill", function (d, i) {
					if (d.Gene_name == null) return "url(#grad" + i + ")";
					genID = d.Gene_name.replace("-", "HYPHEN")
					genID = genID.replace(".", "DOT")
					genID = genID.replace("(", "LB")
					genID = genID.replace(")", "RB")
					genID = genID.replace(/[^A-Za-z0-9]/g, '')
					genID = d.ID + "_" + genID;
					return "url(#" + genID + ")";
				})
				//.style(tocolor, function(d) { return default_node_color; })
				//if(d.direction == "UP") return "red";
				//else if(d.direction == "DOWN") return "green";
				//else return default_node_color; })
				.style("stroke-width", nominal_stroke)
				.style(towhite, "white");

			//Create node labels
			text = vis.selectAll(".text")
				.data(graph.genes)
				.enter().append("text")
				.attr("dy", ".35em")
				.attr("class", "text")
				.style("font-size", nominal_text_size + "px");
			//.style("font-size", "50px");

			if (text_center)
				text.text(function (d) {
					return d.Gene_name == "NA" ? d.ID : d.Gene_name;
				})
					.style("text-anchor", "middle");
			else
				text.attr("dx", function (d) {
					return (size(nodeSizeScale(Math.abs(Number(d[nodeSize])))) || nominal_base_node_size);

				})
					.text(function (d) {
						return d.Gene_name == "NA" ? '\u2002' + d.ID : '\u2002' + d.Gene_name;
					});


		link.on("mouseover", function( d) {
        	const sourceGene = d.source;
          	const targetGene = d.target;
          	if (!sourceGene || !targetGene) {
           	 	return;
          	}
          	gbTootip.transition().duration(500);
          	gbTootip.html(`<strong>Weight:</strong> ${d.weight}`)
            .style("left", (event.pageX + 5) + "px")
            .style("top", (event.pageY - 28) + "px");
          	gbTootip.style("display", "block");
        })
		
      .on("mouseout", function() {
        gbTootip.style("display", "none");
      });

			//Highlight connection of a node and show tooltip on mouseover event

			node.on("mouseover", function (d) {
				set_highlight(d);

				// document.getElementById("mysetting").style.display ="block"
				var gene_info = document.getElementById("gene_info");
				//  gene info on hover  on side tab 
				// gene_info.innerHTML = `<a class='gene_info_link' href="https://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=${d.ID}"  target='_blank'>Id: ${d.ID} </a>` + "<br>"+
				//  "<p class='gene_info'>Description :</p>" + d.Description  + "<br>"+
				//  "<p class='gene_info'>label :</p>" + d.Gene_name + "<br>"+
				//  "<p class='gene_info'>weight :</p>" + d.weight

				gbTootip.transition().duration(500);
				gbTootip.style("top", d3.event.pageY - 5 + "px");
				gbTootip.style("left", d3.event.pageX + 5 + "px");
				gbTootip.html(function () {
					//var tmp1 = "Gene: " + d.ID + "<br>" + "logFC: " + d.logFC.toExponential(2) + "<br>";
					var tmp1 = d.Gene_name ? "Gene: " + d.Gene_name + "<br>" : "";
					var tmp2 = d.ID ? "Ensemble: " + d.ID + "<br>" : "";
					var tmp3 = d.Description ? "Description: " + d.Description + "<br>" : "";
					// var tmp6 = d.Description ? "Weight: " + d.Description + "<br>" : "";
					//################### Update on 8.05.19 #################################//
					if (nodeSize_sel != "") {

						var tmp4 = `<b>${nodeSize_sel}</b>` + ": " + (currentUniversal?.genes[geneIndexMap[d?.ID]][nodeSize_sel] ? (Number(currentUniversal?.genes[geneIndexMap[d?.ID]][nodeSize_sel]).toFixed(2)) : "NA") + "<br>";
					}
					if (nodeColor_sel != "") {
						var tmp5 = `<b>${nodeColor_sel}</b>` + ": " + (currentUniversal?.genes[geneIndexMap[d?.ID]][nodeColor_sel] ? (Number(currentUniversal?.genes[geneIndexMap[d?.ID]][nodeColor_sel]).toFixed(2)) : "NA") + "<br>";
					}
					//################### End_Update on 8.05.19 #################################//
					//var tmp4 = "logFC: " + d.logFC.toExponential(2) + "<br>";
					//d.proteomics_fc == "NA" || typeof d.proteomics_fc == "undefined" ? tmp5 = "" : tmp5 = "Proteomic logFC: " + d.proteomics_fc.toExponential(2) + "<br>"
					//var tmp6 =  d.pvalue ? "P-value: " + d.pvalue.toExponential(2) : "";

					//console.log(d.logFC);
					//return tmp1 + tmp2 + tmp3 +tmp4 +tmp5 +tmp6;
					//console.log("Node size")
					//console.log(nodSize)
					let result = tmp1 + tmp2 + tmp3;
					if (nodeSize_sel != "") {
						result += tmp4;
					}
					if (nodeColor_sel != "") {
						result += tmp5;
					}
					return result;
				})
				gbTootip.style("display", "block");
			})

				//highlight connections & remove tooltip on mousedown event and get back to previous stat on mouseup
				.on("mousedown", function (d) {
					d3.event.stopPropagation();
					gbTootip.transition()
						.delay(250)
						.style("display", "none");
					focus_node = d;
					set_focus(d)
					if (highlight_node === null) set_highlight(d)


				})
				//remove tooltip on mouseout
				.on("mouseout", function (d) {
					let verHighlightEdge = document.getElementById("linkColor1").checked;;
					if (verHighlightEdge == true){
						edge_highlight();
					} else {
						exit_highlight();
					}
						gbTootip.transition()
						.delay(250)
						.style("display", "none");

				})
				/*
			.on("click", function(d) {
					//console.log("click");
					if (d3.event.defaultPrevented) return;
  
					if (!shiftKey) {
						//if the shift key isn't down, unselect everything
						node.selectAll("path").classed("selected", function(p) { //##############################
								//p.previouslySelected = false;
								return p.selected =  p.previouslySelected = false; })
					}
  
					// always select this node
					//node.selectAll("path").select(this).classed("selected", d.selected = !d.previouslySelected);
			})
		*/
				.call(d3.behavior.drag()
					.on("dragstart", dragstarted)
					.on("drag", dragged)
					.on("dragend", dragended));

			//make visible all the nodes on mouseout.
			d3.select(window).on("mouseup",
				function () {
					if (focus_node !== null) {
						focus_node = null;
						if (highlight_trans < 1) {
							circle.style("opacity", 1);
							text.style("opacity", 1);
							link.style("opacity", 1);
						}
					}

					if (highlight_node === null) {
						// exit_highlight();
						let verHighlightEdge = document.getElementById("linkColor1").checked;;
					if (verHighlightEdge == true){
						edge_highlight();
					} else {
						exit_highlight();
					}
					}
					//$("#gene_list").val('');
				});

			//Function to remove highlight colors and make connection to the default condition
			function exit_highlight() {
				//$("#gene_list").val('');
				highlight_node = null;
				if (focus_node === null) {
					svg.style("cursor", "move");
					if (highlight_color != "white") {
						circle.style(towhite, "white");
						text.style("font-weight", "normal");
						link.style("stroke", function (o) {
						 return (isNumber(o.score) && o.score >= 0) ? color(o.score) : default_link_color
						});
					}

				}
			}

			function edge_highlight() {
    			highlight_node = null;
    			if (focus_node === null) {
        			svg.style("cursor", "move");
        			if (highlight_color != "white") {
            			circle.style(towhite, "white");
            			text.style("font-weight", "normal");
            			link.style("stroke", function (o) {
                			let edgeColor; 
							let pWeight = o.weight; 
							if (pWeight <= 0) {
                    			edgeColor = "#fff888"; 
							} else if (pWeight > 0 && pWeight < 0.15) {
                    			if (pWeight > 0 && pWeight <= 0.1) {
                        			edgeColor = "#fff888";  
                    			} else if (pWeight > 0.1 && pWeight <= 0.15) {
                        			edgeColor = "#fff66e"; 
                    			} 
                			} else if (pWeight > 0.15 && pWeight < 0.4) {
                    			if (pWeight > 0 && pWeight <= 0.1) {
                        			edgeColor = "#fff888";  
                    			} else if (pWeight > 0.1 && pWeight <= 0.2) {
                        			edgeColor = "#fff66e"; 
                    			} else if (pWeight > 0.2 && pWeight <= 0.3) {
                       				edgeColor = "#fff33b"; 
                    			} else if (pWeight > 0.3 && pWeight < 0.4) {
                        			edgeColor = "#fdc70c"; 
                    			} 
								
                			} else if (pWeight >= 0.4 && pWeight < 0.7) {
								if (pWeight >= 0.4 && pWeight <= 0.5) {
									edgeColor = "#fff888"; 
								} else if (pWeight > 0.5 && pWeight <= 0.6) {
									edgeColor = "#fff66e"; 
								} else if (pWeight > 0.6 && pWeight < 0.7){
									edgeColor =  "#fff33b"; 
								} else {
									edgeColor = default_link_color;
								}
                			} else if (pWeight >= 0.7 && pWeight < 0.9) {
                    			if (pWeight >= 0.7 && pWeight <= 0.8) {
                        			edgeColor = "#fdc70c";  
                    			} else if (pWeight > 0.8 && pWeight <= 0.9) {
                        			edgeColor = "#f3903f";
                    			} else if (pWeight > 0.9 && pWeight < 1) {
                        			edgeColor = "#ed683c"; 
                    			} else if (pWeight >= 1) {
                        			edgeColor = "#e93e3a"; 
                    			}
                			} else if (pWeight >= 0.9){
						   		if (pWeight == 0.9 && pWeight <= 0.92){
									edgeColor = "#ed943c"; 
							 		// edgeColor = "#fff888"; 
						   		} else if (pWeight > 0.92 && pWeight <= 0.94){
									edgeColor = "#ed863c"; 
							  		// edgeColor = "#fff66e";  
						   		} else if (pWeight > 0.94 && pWeight <= 0.95) {
									edgeColor =  "#ed773c"; 
									// edgeColor =  "#fff33b"; 
								} else if (pWeight > 0.95 && pWeight <= 0.97) {
									edgeColor = "#ed683c"; 
									// edgeColor = "#fdc70c"; 
								} else if (pWeight > 0.97 && pWeight <= 0.99) {
									edgeColor = "#ed593c";
									// edgeColor = "#f3903f"; 
								}else if (pWeight > 0.99 && pWeight < 1) {
									edgeColor = "#ed4a3c";
									// edgeColor = "#ed683c"; 
								}else if (pWeight >= 1) {
									edgeColor = "#e93e3a"; 
									// edgeColor = "#e93e3a"; 
								} else {
									edgeColor = "#c11916";
									// edgeColor = default_link_color;
								}
							}
               			// if (o.weight <= 0) {
                    	// 	edgeColor = "#fff888"; 
                		// } else if (o.weight >= 0.15 && o.weight < 0.4) {
                    	// 	if (o.weight > 0 && o.weight <= 0.5) {
                        // 		edgeColor = "#fff888";  
                    	// 	} else if (o.weight > 0.5 && o.weight <= 0.6) {
                        // 		edgeColor = "#fff66e"; 
                    	// 	} else if (o.weight > 0.6 && o.weight <= 0.7) {
                       	// 		edgeColor = "#fff33b"; 
                    	// 	} else if (o.weight > 0.7 && o.weight <= 0.8) {
                        // 		edgeColor = "#fdc70c"; 
                    	// 	} else if (o.weight > 0.8 && o.weight <= 0.9) {
                        // 		edgeColor = "#f3903f";
                    	// 	} else if (o.weight > 0.9 && o.weight < 1) {
                        // 		edgeColor = "#ed683c"; 
                    	// 	} else if (o.weight >= 1) {
                        // 		edgeColor = "#e93e3a"; 
                    	// 	}
                		// } else if (o.weight >= 0.4 && o.weight < 0.7) {
						// 	if (o.weight = 0.4 && o.weight <= 0.5) {
						// 		edgeColor = "#fff888"; 
						// 	} else if (o.weight > 0.5 && o.weight <= 0.6) {
						// 		edgeColor = "#fff66e"; 
						// 	} else if (o.weight > 0.6 && o.weight < 0.7){
						// 		edgeColor =  "#fff33b"; 
						// 	} else {
						// 		edgeColor = default_link_color;
						// 	}
                		// } else if (o.weight >= 0.7 && o.weight < 0.9) {
                    	// 	if (o.weight >= 0.7 && o.weight <= 0.8) {
                        // 		edgeColor = "#fdc70c";  
                    	// 	} else if (o.weight > 0.8 && o.weight <= 0.9) {
                        // 		edgeColor = "#f3903f";
                    	// 	} else if (o.weight > 0.9 && o.weight < 1) {
                        // 		edgeColor = "#ed683c"; 
                    	// 	} else if (o.weight >= 1) {
                        // 		edgeColor = "#e93e3a"; 
                    	// 	}
                		// } else if (o.weight >= 0.9){
						//    if (o.weight == 0.9 && o.weight <= 0.92){
						// 	edgeColor = "#ed943c"; 
						// 	 // edgeColor = "#fff888"; 
						//    } else if (o.weight > 0.92 && o.weight <= 0.94){
						// 	edgeColor = "#ed863c"; 
						// 	  // edgeColor = "#fff66e";  
						//    	} else if (o.weight > 0.94 && o.weight <= 0.95) {
						// 		edgeColor =  "#ed773c"; 
						// 		// edgeColor =  "#fff33b"; 
						// 	} else if (o.weight > 0.95 && o.weight <= 0.97) {
						// 		edgeColor = "#ed683c"; 
						// 		// edgeColor = "#fdc70c"; 
						// 	} else if (o.weight > 0.97 && o.weight <= 0.99) {
						// 		edgeColor = "#ed593c";
						// 		// edgeColor = "#f3903f"; 
						// 	}else if (o.weight > 0.99 && o.weight < 1) {
						// 		edgeColor = "#ed4a3c";
						// 		// edgeColor = "#ed683c"; 
						// 	}else if (o.weight >= 1) {
						// 		edgeColor = "#e93e3a"; 
						// 		// edgeColor = "#e93e3a"; 
						// 	} else {
						// 		edgeColor = "#c11916";
						// 		// edgeColor = default_link_color;
						// 	}
						// }
                        return edgeColor; 
            		});
        		}
    		}
		}

		$("input[name='highlight_seedEdge'][value='7']").change(function () {
			if ($(this).is(':checked')){
				edge_highlight();
			} else {
				exit_highlight();
			}
		});

			//Function to show the connection and hide others on mouse down.
			function set_focus(d) {
				if (highlight_trans < 1) {
					circle.style("opacity", function (o) {
						return isConnected(d, o) ? 1 : highlight_trans;
					});

					text.style("opacity", function (o) {
						return isConnected(d, o) ? 1 : highlight_trans;
					});

					link.style("opacity", function (o) {
						return o.source.index == d.index || o.target.index == d.index ? 1 : highlight_trans;
					});
				}
			}



			//Function to highlight the connection using blue border.
			function set_highlight(d) {
				svg.style("cursor", "pointer");
				if (focus_node !== null) d = focus_node;
				highlight_node = d;
				//Edit
				//prompt(highlight_node)
				//
				if (highlight_color != "white") {
					circle.style(towhite, function (o) {
						return isConnected(d, o) ? highlight_color : "white";
					});
					text.style("font-weight", function (o) {
						return isConnected(d, o) ? "bold" : "normal";
					});
					link.style("stroke", function (o) {
						return o.source.index == d.index || o.target.index == d.index ? highlight_color : ((
							isNumber(o.score) && o.score >= 0) ? color(o.score) : default_link_color);

					});

				}

			}

			//Zoom-in/out by scroll button to see the specific part/connection of whole network.
			zoom.on("zoom", function () {

				var stroke = nominal_stroke;
				if (nominal_stroke * zoom.scale() > max_stroke) stroke = max_stroke / zoom.scale();
				link.style("stroke-width", stroke);
				circle.style("stroke-width", stroke);

				var base_radius = nominal_base_node_size;
				if (nominal_base_node_size * zoom.scale() > max_base_node_size) base_radius =
					max_base_node_size / zoom.scale();
				circle.attr("d", d3.svg.symbol()
					.size(function (d) {
						//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
						thisNodeSize = uniNode.genes[d.ID] ? size(nodeSizeScale(Math.pow(2, Math.abs(
							Number(uniNode.genes[d.ID][uniNode.headers[nodeSize]]))))) : "";
						//console.log(thisNodeSize);
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ?
							max_base_node_size : thisNodeSize || nominal_base_node_size, 2);
						//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2, Math.abs(Number(d[nodeSize])))))||base_radius,2);

					})
					.type(function (d) {
						return d.type;
					}))

				//circle.attr("r", function(d) { return (size(nodeSizeScale(Math.abs(Number(d.logFC))))*base_radius/nominal_base_node_size||base_radius); })
				if (!text_center) text.attr("dx", function (d) {
					//return (size(nodeSizeScale(Math.pow(2,Math.abs(Number(nodeSize))))) || nominal_base_node_size);
					return (size(nodeSizeScale(Math.abs(Number(d[nodeSize])))) ||
						nominal_base_node_size);

				});

				var text_size = nominal_text_size;
				//var text_size_hovar = nominal_text_size_hovar;
				if (nominal_text_size * zoom.scale() > max_text_size) text_size = max_text_size / zoom
					.scale();
				//if (nominal_text_size_hovar*zoom.scale()>max_text_size_hovar) text_size_hovar = max_text_size_hovar/zoom.scale();
				text.style("font-size", text_size + "px");

				nominal_text_size_hovar * zoom.scale() > max_text_size_hovar ? text_size =
					max_text_size_hovar : nominal_text_size_hovar * zoom.scale() < nominal_text_size_hovar ?
					text_size = nominal_text_size_hovar : text_size = nominal_text_size_hovar * zoom.scale();
				//text.style("font-size",text_size + "px");
				//text.style("font-size","5px");
				gbTootip.style("font-size", text_size + "px");

				vis.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
			});

			//svg.call(zoom);

			resize();
			//window.focus();
			// Resizing the window and hide/show nodes/connections on keydown
			d3.select(window).on("resize", resize).on("keydown", keydown);
			force.on("tick", function () {
				node.attr("transform", function (d) {
					return "translate(" + d.x + "," + d.y + ")";
				});
				text.attr("transform", function (d) {
					return "translate(" + d.x + "," + d.y + ")";
				});

				link.attr("x1", function (d) {
					return d.source.x;
				})
					.attr("y1", function (d) {
						return d.source.y;
					})
					.attr("x2", function (d) {
						return d.target.x;
					})
					.attr("y2", function (d) {
						return d.target.y;
					});

				node.attr("cx", function (d) {
					return d.x;
				})
					.attr("cy", function (d) {
						return d.y;
					});

			let verHighlightEdge = document.getElementById("linkColor1").checked;;
			if (verHighlightEdge == true){
				edge_highlight();
			} else {
				exit_highlight();
			}
			});

			function resize() {
				var width = window.innerWidth,
					height = window.innerHeight;
				svg.attr("width", width).attr("height", height);

				force.size([force.size()[0] + (width - w) / zoom.scale(), force.size()[1] + (height - h) / zoom
					.scale()
				]).resume();
				w = width;
				h = height;
			}
		}

		//Read Pathway specific JSON to create a force directed graph
		// let l = document.getElementById('loader');
		let thisCheck = getItemFromStorage('pd_net_stringDB');
		var currentUniversal;
		var initialUniversal;
		var geneIndexMap = {};

		if (thisCheck != undefined || thisCheck != null) {
			let d = JSON.parse(thisCheck);
			
			$("#diseaseMap").val(d?.disease ?? "ALS");

			$.ajax({
				url: 'http://api.tdp-dev.alexion.cloud/graphql',
				// url: `https://pdnet-rnd-apis.crecientech.com/graphql`,
				type: "POST",
				dataType: 'json',
				data: JSON.stringify({
					query: `query GeneGraph($geneIDs: [String!]!, $minScore: Float!, $order: Int!, $interactionType: String!) {
							  	getGeneInteractions(input: 
								{ geneIDs: $geneIDs, minScore: $minScore, interactionType: $interactionType },order: $order) {
							    	genes {
										ID
										hgnc_gene_id
										hgnc_gene_symbol
										Description
										Gene_name
										common
										${d?.disease}
							    	}
									links {
										gene1 {
											ID
											index
										}
										gene2 {
											ID
											index
										}
										score
									}
							  	}
							}`,
					variables: {
						"geneIDs": d.nodeNames,
						"minScore": d.score,
						"order": d.order,
						"interactionType": d.type
					}
				}),
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				success: function (result) {
					$("#loader").css('display', 'none')
					var totalEdges = result.data.getGeneInteractions.links.length;
					var totalNodes = result.data.getGeneInteractions.genes.length;

					// if (totalNodes > 5000 || totalEdges > 10000) {
					// 	$('#node-modal-background-alert').css('display', 'block')
					// }  //commented by Vandana.
					//below code added by Vandana (Start)
					if (totalNodes >= 5000) {
						$('#node-modal-background-alert').css('display', 'block')
					}
                    //code added by Vandana (End)
					$('#network_details').append(`<div style="margin: 10px 5px; font-size: 13px; color: #FFFFFF;">Total Nodes: ${totalNodes}<br>Total Edges: ${totalEdges}</div>`)
					$("#loader").css('display', 'none')
					currentUniversal = result.data?.getGeneInteractions;
					currentUniversal?.genes.forEach((gene, idx) => {
						geneIndexMap[gene.ID] = idx;
						geneIndexMap[gene?.Gene_name] = idx;
						Object.keys(gene.common).forEach((key) => {
							gene[key] = gene.common[key];
						});
						delete gene.common;
						Object.keys(gene[d?.disease]).forEach((key) => {
							gene[key] = gene[d?.disease][key];
						});
						delete gene[d?.disease];
					});
					startD3(currentUniversal);
					getUniversal(currentUniversal);
					initialUniversal = JSON.parse(JSON.stringify(currentUniversal));
					for (let i of d.nodeNames) {
						y = i.split(/\s*[,\n]+\s*[,\n]*\s*/);
				    	color_input_genes2(y);
					}
				 },
				error: function (err) {
					$("#loader").css('display', 'none')
					alert(err.responseJSON ? err.responseJSON.message : "There is an issue. Please try after some time");
					// window.location.href = '/pdnet';
				}
			});

		}
		// ===============================================d3.json() ends=============================>>>>>>>>>>>>>>>>
		var linkedByIndex = {};

        //================= highlight input seed genes =============================>>>>
		function color_input_genes2(y) {
		  	d3.selectAll(".node").each(function (d) {
		  		if (y.indexOf(d.Gene_name) > -1 || y.indexOf(d.ID) > -1) {
					d3.selectAll("*[id^=" + d.ID.replace(/\./g, 'DOT') + "_]," + "*[id$=_" + d.Gene_name
					.replace(/\./g, 'DOT') + "]").select("stop[offset='100%']")
					.style("stop-color", "blue");
				}
		  	})
		}

		function keydown() { // this funtion is for key control

			// console.log('d3.event', d3.event)
			shiftKey = d3.event.shiftKey || d3.event.metaKey;
			ctrlKey = d3.event.ctrlKey;

			if (shiftKey) {
				//console.log("Shift down")
				svg_graph.call(zoomer)
					.on("mousedown.zoom", null)
					.on("touchstart.zoom", null)
					.on("touchmove.zoom", null)
					.on("touchend.zoom", null);

				//svg_graph.on('zoom', null);
				vis.selectAll('g.gnode')
					.on('mousedown.drag', null);

				brush.select('.background').style('cursor', 'crosshair')
				brush.call(brusher);
			}
			if (d3.event.keyCode == 32) {
				force.stop();
			} else if (d3.event.keyCode >= 48 && d3.event.keyCode <= 90 && !d3.event.ctrlKey && !d3.event.altKey && !d3.event
				.metaKey) {
				switch (String.fromCharCode(d3.event.keyCode)) {
					case "C":
						keyc = !keyc;
						break;
					case "S":
						keys = !keys;
						break;
					case "T":
						keyt = !keyt;
						break;
					case "R":
						keyr = !keyr;
						break;
					case "X":
						keyx = !keyx;
						break;
					case "D":
						keyd = !keyd;
						break;
					case "L":
						keyl = !keyl;
						break;
					case "M":
						keym = !keym;
						break;
					case "H":
						keyh = !keyh;
						break;
					case "1":
						key1 = !key1;
						break;
					case "2":
						key2 = !key2;
						break;
					case "3":
						key3 = !key3;
						break;
					case "0":
						key0 = !key0;
						break;
				}

				//EDITED
				link.style("display", function (d) {

					// console.log(d)
					//console.log(d)
					//var flag  = vis_by_type(d.source.type)&&vis_by_type(d.target.type)&&vis_by_node_score(d.source.score)&&vis_by_node_score(d.target.score)&&vis_by_link_score(d.weight);
					var flag = vis_by_node_score(d.source.score) && vis_by_node_score(d.target.score) &&
						vis_by_link_score(d.weight);
					linkedByIndex[d.source.index + "," + d.target.index] = flag;
					// console.log(flag, "flag")
					return flag ? "inline" : "inline";
				});
				node.style("display", function (d) {
					return (key0 || hasConnections(d)) && vis_by_type(d.type) && vis_by_node_score(d.score) ?
						"inline" : "none";
				});
				text.style("display", function (d) {
					return (key0 || hasConnections(d)) && vis_by_type(d.type) && vis_by_node_score(d.score) ?
						"inline" : "none";
				});

				if (highlight_node !== null) {
					if ((key0 || hasConnections(highlight_node)) && vis_by_type(highlight_node.type) && vis_by_node_score(
						highlight_node.score)) {
						if (focus_node !== null) set_focus(focus_node);
						set_highlight(highlight_node);
						//Edit
						//prompt(highlight_node)
					} else {
						console.log("at 2702");
						exit_highlight();
					}
				}
				//
				//console.log(highlight_node);
				//

			}
		}


		function keyup() {
			//console.log("key up")
			shiftKey = d3.event.shiftKey || d3.event.metaKey;
			ctrlKey = d3.event.ctrlKey;

			brush.call(brusher)
				.on("mousedown.brush", null)
				.on("touchstart.brush", null)
				.on("touchmove.brush", null)
				.on("touchend.brush", null);

			brush.select('.background').style('cursor', 'auto')
			svg_graph.call(zoomer);
		}

		//Show hide nodes/links based on weight/score/type (only show/hide link is working)
		function vis_by_type(type) {
			switch (type) {
				case "circle":
					return keyc;
				case "square":
					return keys;
				case "triangle-up":
					return keyt;
				case "diamond":
					return keyr;
				case "cross":
					return keyx;
				case "triangle-down":
					return keyd;
				default:
					return true;
			}
		}

		function vis_by_node_score(score) {
			if (isNumber(score)) {
				if (score >= 0.666) return keyh;
				else if (score >= 0.333) return keym;
				else if (score >= 0) return keyl;
			}
			return true;
		}

		function vis_by_link_score(score) {
			if (isNumber(score)) {
				if (score >= 0.666) return key3;
				else if (score >= 0.333) return key2;
				else if (score >= 0) return key1;
			}
			return true;
		}

		function isNumber(n) {
			return !isNaN(parseFloat(n)) && isFinite(n);
		}


		/*EDITED
	    
		function findLargest() {
		  var largest = null,
		  weight = 0;
		  node.each(function(d) {
		   var connections = link.filter(function(l) {
				return l.source.index == d.index || l.target.index == d.index
			  });
			  d.weight = connections.size();
			  if (d.weight > weight) {
				largest = {
				  node: this,
				  links: connections
				};
				weight = d.weight;
	    
			  }
		  });
		  /*if (largest) {
			  d3.select(largest.node).select("circle")
				.style("fill", "red")
				.style("stroke-width", 3);
			  largest.links.each(function() {
				d3.select(this).style("stroke", "red").style("stroke-width", 3);;
			  })
		  }
		}
		/* END EDITED */


		//---Insert-------
		//adjust threshold and recreate graph with connections having weight >= threshold


		/* forec network setting script   */

		let linkdistance = document.getElementById("linkdistance");
		let linkcharge = document.getElementById("linkcharge");
		let linkdistanceinput = document.getElementById("linkdistanceinput");
		let linkchargeinput = document.getElementById("linkchargeinput");
		let linkStrength = document.getElementById("linkStrength");
		let linkStrengthinput = document.getElementById("linkStrengthinput");


		linkdistance.addEventListener("change", linkdistanceFunc)
		linkcharge.addEventListener("change", linkchargeFunc)
		linkStrength.addEventListener("change", linkstrengthFunc)

		function linkdistanceFunc() {

			linkdistanceinput.innerHTML = this.value
			force.linkDistance(this.value)
			force.start()
		}

		function linkchargeFunc() {
			linkchargeinput.innerHTML = this.value;
			force.charge(this.value)
			force.start()
		}

		function linkstrengthFunc() {
			// console.log(this.value)
			linkStrengthinput.innerHTML = this.value;
			force.distance(this.value)

			force.start()
			// setTimeout(function(){
			// 	force.alpha(0);
			// },1000);
		}


		/* EDITED for Threshold for weight */


		// weightFunc();
		var slider = document.getElementById("myRange");
		var output = document.getElementById("thresh");
		var degree = document.getElementById("myDegree");
		var degreeOutput = document.getElementById("thresh1");		
		var myConnection = document.getElementById("myConnection");
		var ConnectionOutput = document.getElementById("thresh2");
		var TEdegree = document.getElementById("myTEvalues");
		var TEdegreeOutput = document.getElementById("thresh3");
		degreeOutput.innerHTML = 0;
		ConnectionOutput.innerHTML = 0;
		TEdegreeOutput.innerHTML = 0;
		myConnection.addEventListener("change", ConnectionFun)
		degree.addEventListener("change", DegreeFun);
		slider.addEventListener("change", weightFunc);
        TEdegree.addEventListener("change", TEdegreeFun);
		function weightFunc() {
			//var textval=10
			// console.log('LINK CUT', this.value || 1);
			output.innerHTML = this.value;
			graph.links.splice(0, graph.links.length);
			for (var i = 0; i < graphRec.links.length; i++) {
				if (graphRec.links[i].weight >= this.value) {
					graph.links.push(graphRec.links[i]);
				}
			}
			degreeOutput.innerHTML = 0;
			document.getElementById("myDegree").value = 0;
			DegreeFun()
			restart();
			TEdegreeOutput.innerHTML = 0;
		 	document.getElementById("myTEvalues").value = 0;
            TEdegreeFun()
		 	restart();
		}


		function ConnectionFun() {
			let countHub = 0;
			hubGenesArray.length = 0;
			ConnectionOutput.innerHTML = this.value;
			var myval1 = this.value;
			d3.selectAll(".node").each(function (d) {
				if (d.weight >= myval1 && myval1 >= 1) {
					countHub++;
					d3.selectAll("*[id^=" + d.ID
						.replace(/\./g, 'DOT') + "_]," + "*[id$=_" + d.Gene_name
							.replace(/\./g, 'DOT') + "]")
						.select("stop[offset='100%']")
						.style("stop-color", "blue");

					hubGenesArray.push(d)
				} else {
					d3.selectAll("*[id^=" + d.ID
						.replace(/\./g, 'DOT') + "_]," + "*[id$=_" + d.Gene_name
							.replace(/\./g, 'DOT') + "]")
						.select("stop[offset='100%']")
						.style("stop-color", default_node_color);
				}
			})
			console.log(countHub)
			if (countHub) {
				console.log(hubGenesArray);
				document.getElementById('hub_genes_button_div').innerHTML = "";
				document.getElementById('table_data-ip-2').innerHTML = ""
				$('#hub_genes_button_div').append(
					`<button onclick="showModalHUB()" style=" margin: 0px 0px 10px 0px;padding: 5px 10px; color: black; float: left">Node Details</button>`
				);
				for (let i of hubGenesArray) {
					$('#table_data-ip-2')
						.append(
							`<tr>
      						<td style="width: 50px;">${hubGenesArray.indexOf(i) + 1}.</td>
      						<td>${i.Gene_name}</td>
      						<td>${i.id}</td>
      						<td style="width: 360px;">${i.Description}</td>
      					</tr>`
						)
				}
			} else {
				document.getElementById('hub_genes_button_div').innerHTML = "";
				document.getElementById('table_data-ip-2').innerHTML = ""
				hubGenesArray.length = 0;
			}
		}


		function DegreeFun() {
			// console.log(this.value,"event value")
			degreeOutput.innerHTML = this.value || 0;
			// console.log(this.value)
			if (typeof this.value == "undefined") {
				// console.log("jjd")
				this.value = 0;
			}
			var degreeVal = this.value || 0;
			// console.log(graph)
			const totalNodes = d3.selectAll(".node")
				.filter(d => {
					return d.weight >= degreeVal;
				})
				.style("display", "inline").size();
			d3.selectAll(".node")
				.filter(d => {
					return d.weight < degreeVal;
				})
				.style("display", "none");
			const totalEdges = d3.selectAll(".link")
				.filter(d => {
					return d.target.weight >= degreeVal
				})
				.style("display", "inline").size();
			d3.selectAll(".link")
				.filter(d => {
					return d.source.weight >= degreeVal
				})
				.style("display", "inline");
			d3.selectAll(".link")
				.filter(d => {
					return d.target.weight < degreeVal
				})
				.style("display", "none");
			d3.selectAll(".link")
				.filter(d => {
					return d.source.weight < degreeVal
				})
				.style("display", "none");
			d3.selectAll(".text")
				.filter(d => {
					// console.log(d.weight)
					return d.weight >= degreeVal;
				})
				.style("display", "inline");
			d3.selectAll(".text")
				.filter(d => {
					// console.log(d.weight)
					return d.weight < degreeVal;
				}).style("display", "none");
			$('#network_details').empty();
			$('#network_details').append(`<div style="margin: 10px 5px; font-size: 13px; color: #FFFFFF;">Total Nodes: ${totalNodes}<br>Total Edges: ${totalEdges}</div>`);
		}

		function TEdegreeFun() {
			TEdegreeOutput.innerHTML = this.value || 0;
			if (typeof this.value == "undefined") {
				this.value = 0;
			}
			var degreeValTE = this.value || 0;
			const totalNodes = d3.selectAll(".node")
				.filter(d => {
					return d.weight >= degreeValTE;
				})
				.style("display", "inline").size();
			d3.selectAll(".node")
				.filter(d => {
					return d.weight < degreeValTE;
				})
				.style("display", "none");
			const totalEdges = d3.selectAll(".link")
				.filter(d => {
					return d.target.weight >= degreeValTE
				})
				.style("display", "inline").size();
			d3.selectAll(".link")
				.filter(d => {
					return d.source.weight >= degreeValTE
				})
				.style("display", "inline");
			d3.selectAll(".link")
				.filter(d => {
					return d.target.weight < degreeValTE
				})
				.style("display", "none");
			d3.selectAll(".link")
				.filter(d => {
					return d.source.weight < degreeValTE
				})
				.style("display", "none");
			d3.selectAll(".text")
				.filter(d => {
					return d.weight >= degreeValTE;
				})
				.style("display", "inline");
			d3.selectAll(".text")
				.filter(d => {
					return d.weight < degreeValTE;
				}).style("display", "none");
			$('#network_details').empty();
			$('#network_details').append(`<div style="margin: 10px 5px; font-size: 13px; color: #FFFFFF;">Total Nodes: ${totalNodes}<br>Total Edges: ${totalEdges}</div>`);
		}


		// slider.oninput =  function() {
		//   //var textval=10
		//   output.innerHTML = this.value;
		//   var myinout = this.value;
		//   graph.links.splice(0, graph.links.length);

		//   graphRec.links.forEach(function(val){
		// 		if(val.weight > myinout){
		// 			graph.links.push(val);
		// 		}
		// 	});

		// 	console.log(graph.links,"kkkk",graph.nodes)
		// 	restart();
		// }

		// function filternodes(){
		// 	graph.nodes.splice(0, graph.nodes.length);
		// 	console.log(graph.links,"kkkk",graph.nodes)
		// 	console.log()

		// }


		/* EDITED END*/

		//---Insert-------
		//adjust threshold and recreate graph with connections having weight >= threshold
		/* EDITED for Threshold for Degree
	    
		var slider1 = document.getElementById("myDegree");
		var output1 = document.getElementById("thresh1");
		slider1.oninput = function() {
		  //var textval=10
		  output1.innerHTML = this.value;
	    
		  graph.links.splice(0, graph.links.length);
	    
			  for (var i = 0; i < graphRec.links.length; i++) {
				  if (graphRec.links[i].weight > this.value) {graph.links.push(graphRec.links[i]);}
			  }
			  restart();
		}
		/* EDITED END*/


		//Restart the visualisation after any node and link changes
		function restart() {
			link = link.data(graph.links);
			link.exit().remove();
			link.enter().insert("line", ".node").attr("class", "link");
			// node = node.data(graph.nodes);
			// node.exit().remove();
			// node.enter().insert("circle", ".cursor").attr("class", "node");
			force.start();
		}
		//---End Insert---

		function getNodeSizeScale(nss) {
			let a = [];
			$.each(uniNode.genes, function (idx, d) {
				if (d[nss] != undefined || d[nss] != null || Number(d[nss]) != NaN) {
					a.push(Math.abs(Number(d[nss])));
				} else {
					a.push(0);
				}
			});
			//d3.min((uniNode.genes, function(d){console.log(uniNode.genes[d][uniNode.headers[nodeSize]]);}))
			return d3.scale.linear()
				.domain([d3.min(a), d3.max(a)])
				.range([min_base_node_size, max_base_node_size1]);
		}

		//find node
		$("#geneinput").submit(function (e) {
			e.preventDefault();
			e.stopImmediatePropagation();

			//console.log(e)
			//console.log("INSISE FIND NODE")
			function highlight_genes(y) {
				yed = [];
				d3.selectAll(".node").each(function (d) {
					if (y.indexOf(d.Gene_name) > -1 || y.indexOf(d.ID) > -1) {
						d3.selectAll("*[id^=" + d.ID.replace(/\./g, 'DOT') + "_]," + "*[id$=_" + d.Gene_name
							.replace(/\./g, 'DOT') + "]").select("stop[offset='100%']").style(
								"stop-color", "blue");
					}
				})


				/*y.forEach(function(d){
					var modgene = d.replace(/\./g, 'DOT');
					modgene = modgene.replace(/-/g, 'HYPHEN');
					modgene = modgene.replace("(", "LB")
					modgene = modgene.replace(")", "RB")
					modgene = modgene.replace(/,/, "")
					modgene = modgene.replace(/\s/, "")
	  
	  
					d3.selectAll("*[id^="+modgene+"_],"+"*[id$=_"+modgene+"]").select("stop[offset='100%']").style("stop-color",  "blue");
					console.log("*[id^="+modgene+"_],"+"*[id$=_"+str+"]")
					//d3.selectAll("*[id^="+d+"_],"+"*[id$=_"+d+"]").select("stop[offset='100%']").style("stop-color",  "blue");
	  
				})*/
			}

			if (document.getElementById("gene_list").value != "") {
				var y = [];
				var str = document.getElementById("gene_list").value.toUpperCase().trim().replace(/(^,+)|(,+$)/g, "")
				//edited
				//str = str.replace(/\./g, 'DOT');

				//str = str.replace(/-/g, 'HYPHEN');
				//str = str.replace("(", "LB")
				//str = str.replace(")", "RB")
				//str = str.replace(/,/, "")
				//str = str.replace(/\s/, "")
				y = str.split(/\s*[,\n]+\s*[,\n]*\s*/);
				// console.log(y)
				highlight_genes(y)

			}


		});

		//*********************************Color ******************************************************
		//Change the data for coloring the node and apply it on network
		function chkBoxNodeColor(){
			const cbs_highlightEdgeNode = document.querySelectorAll('input[name="highlight_seedEdge"]');
            const isNodeColor1Checked = Array.from(cbs_highlightEdgeNode).find(cb_highlightEdgeNode => cb_highlightEdgeNode.id === 'nodecolor1').checked;

			if (isNodeColor1Checked) {
				highlightNodes();
			} else {
				d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
					return default_node_color;
				});
			}}

		$("input[name='nodeColor']").change(function () {
			chkBoxNodeColor();
			//Reset to default color
			if ($(this).val() === '0') {

				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#logFCInput").style("display", "none");
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			} else if ($(this).val() === '1') { //color based on differential expression (Directions: up/down/none)
				// $('#Direction').
				d3.select("#directionInput").style("display", "block");
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/* d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
					   if(d.direction == "UP") {  return "red";}
					   else if(d.direction == "DOWN") return "green";
					   else return default_node_color;
				   }); */
				d3.select("#pathwayInput").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 1);
				d3.select("#logFCInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");


			} else if ($(this).val() === '2') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "block");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			} else if ($(this).val() === '3') { //color based on presence in pathway/s

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				d3.select("#pathwayInput").style("display", "block");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 1);
				d3.select("#logFCInput").style("display", "none");
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			} else if ($(this).val() === '4') { //color based on presence in trait list (p-values from articles)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
					//if(d["trait_Module ID"] && d["trait_Module ID"] != "NA") {return "red";}
					// if (uniNode.genes[d.ID] && uniNode.genes[d.ID][uniNode.headers["druggability_Module_ID"]] != "NA") { return "red"; }
				// 	return default_node_color;
				// });
				d3.select("#druggabilityInput").style("display", "block");
				d3.select("#pathwayInput").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 1);
				d3.select("#logFCInput").style("display", "none");
				d3.select("#directionInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			} else if ($(this).val() === '5') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#GWASInput").style("display", "block");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#logFCInput").style("display", "none");
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			} else if ($(this).val() === '6') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "block");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");


			} else if ($(this).val() === '7') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "block");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");


			} else if ($(this).val() === '8') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "block");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");


			} else if ($(this).val() === '9') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "block");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			}

			else if ($(this).val() === '10') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {

				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "block");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select("#TEInput").style("display", "none");

			}

			else if ($(this).val() === '11') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "block");
				d3.select("#TEInput").style("display", "none");


			} else if ($(this).val() == '12') {
				// d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// 	return default_node_color;
				// });
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "none");
				d3.select("#custom_color_input").style("display", "none");
				d3.select("#GDAInput").style("display", "none");
				d3.select("#GWAS_OR_Input").style("display", "none");
				d3.select("#GWAS_Beta_Input").style("display", "none");
				d3.select('#TEInput').style('display', 'block');
			}

		});

		// ********************************* Colour based on the selected option ******************************************************

		//on selecting custom color, color the nodes
	
		document.getElementById("custom4Color").onchange = function () {
			nodeColor_sel = document.getElementById("custom4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let mks = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("custom4Color").value] ?? undefined;
				// if (mks) {
				// 	let color_arr = ['red', 'green', 'yellow', 'black', 'blue', 'orange']
				// 	if (color_arr.includes(mks)) {
				// 		return mks;
				// 	}
				// 	else return default_node_color;
				// }
				// else return default_node_color;

				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (mks) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					let color_arr = ['red', 'green', 'yellow', 'black', 'blue', 'orange']
					if (color_arr.includes(mks)) {
						return mks;
					} else {
						
						if (isNodeColor1Checked == true){
							highlightNodes();	
						} else {
							removeHighlightNodes();
						}
						return default_node_color;	
					}
    			} else {
					return default_node_color;
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
   				}
			});
		}

		//on selecting Direction type, color the nodes

		document.getElementById("directionID4Color").onchange = function () {
			nodeColor_sel = document.getElementById("directionID4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				var dirc = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("directionID4Color").value] ?? undefined;
				if (dirc == "UP") {
					return "red";
				} else if (dirc == "DOWN") return "green";
				// else if (dirc == "undefined") return "black";
				else return default_node_color;
				//return uniNode.genes[d.ID] ? uniNode.genes[d.ID][uniNode.headers[document.getElementById("directionID4Color").value]] == "red" ?  : "black";
			});
		}

		//on selecting logFC type, color the nodes

		document.getElementById("logFCID4Color").onchange = function () {			
			nodeColor_sel = document.getElementById("logFCID4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				// uniNode.genes[d.ID] ? "" : console.log(d.ID);
				//return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document.getElementById("logFCID4Color").value]])) : default_node_color;
				// return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document
				// 	.getElementById("logFCID4Color").value]])) : "black";
				// return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document
				// 	.getElementById("logFCID4Color").value]])) : default_node_color;
				let val = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("logFCID4Color").value];
				// return val ? expressionColor(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return expressionColor(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
				  
			});
		}

		//on selecting GWAS type, color the nodes

		document.getElementById("GWAS4Color").onchange = function () {
			nodeColor_sel = document.getElementById("GWAS4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let gw = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GWAS4Color").value] ?? undefined;
				// return gw && gw >= 1 ? "red" : default_node_color;

				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (gw && gw >= 1) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return "red";
    			} else {
				
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}


		//on selecting Databases type, color the nodes

		document.getElementById("DBs4Color").onchange = function () {
			nodeColor_sel = document.getElementById("DBs4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let dbs = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("DBs4Color").value] ?? undefined;
				// return dbs && dbs >= 1 ? "red" : default_node_color;

				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (dbs && dbs >= 1) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return "red";
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		//on selecting Celltype Markers, color the nodes

		document.getElementById("markers4Color").onchange = function () {
			nodeColor_sel = document.getElementById("markers4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				var mks = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("markers4Color").value] ?? undefined;
				// return mks && mks >= 1 ? "red" : default_node_color;

				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (mks && mks >= 1) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return "red";
    			} else {
					
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}


		//on selecting pathway name, color the nodes

		document.getElementById("pathwayID4Color").onchange = function () {
			nodeColor_sel = document.getElementById("pathwayID4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				var pat = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("pathwayID4Color").value] ?? undefined;
				// return pat && pat == 1 ? "red" : default_node_color;

				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (pat && pat == 1) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return "red";
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		// on selecting Druggability for color change

		document.getElementById("druggabilityID4Color").onchange = function () {
			nodeColor_sel = document.getElementById("druggabilityID4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				//return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document.getElementById("logFCID4Color").value]])) : default_node_color;
				// return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document
				// 	.getElementById("druggabilityID4Color").value]])) : "black";
				let val = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("druggabilityID4Color").value];
                // console.log("val ==", val)
				//   return val ? expressionColor(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return expressionColor(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		// on selecting GDA for color change

		document.getElementById("GDAID4Color").onchange = function () {
			nodeColor_sel = document.getElementById("GDAID4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				//return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document.getElementById("logFCID4Color").value]])) : default_node_color;
				// return uniNode.genes[d.ID] ? expressionColor(Number(uniNode.genes[d.ID][uniNode.headers[document
				// 	.getElementById("druggabilityID4Color").value]])) : "black";
				let val = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GDAID4Color").value];
				// return val ? expressionColor(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return expressionColor(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		// on selecting GWAS OR for color change

		document.getElementById("GWAS_OR4Color").onchange = function () {
			nodeColor_sel = document.getElementById("GWAS_OR4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let val = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GWAS_OR4Color").value];
				// return val ? expressionColor(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return expressionColor(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		// on selecting GWAS Beta for color change

		document.getElementById("GWAS_Beta4Color").onchange = function () {
			nodeColor_sel = document.getElementById("GWAS_Beta4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let val = currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GWAS_Beta4Color").value];
				// return val ? expressionColor(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return expressionColor(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}

		// on selecting TE Score for color change

		document.getElementById("TE4Color").onchange = function () {
			nodeColor_sel = document.getElementById("TE4Color").value;
			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				let val = currentUniversal?.genes[geneIndexMap[d?.ID]][document.getElementById("TE4Color").value];
				// return val ? d3.scale.linear()
				// 	.domain([0, 1])
				// 	.range([default_node_color, "red"])(Number(val)) : default_node_color;
				let isNodeColor1Checked = document.getElementById('nodecolor1').checked;
				if (val) {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					}
					return d3.scale.linear()
					.domain([0, 1])
					.range([default_node_color, "red"])(Number(val));
    			} else {
					if (isNodeColor1Checked == true){
						highlightNodes();	
					} else {
						removeHighlightNodes();
					}
					return default_node_color;
   				}
			});
		}


		//*********************************SIZE ******************************************************
		//Change the data for sizing the node and apply it on network

		$("input[name='nodeSize']").change(function () {
			nodeSize = '';
			nodeSize_sel = nodeSize;
			//console.log(d3.selectAll(".text"));
			//nodeSizeScaleFC = d3.scale.linear()
			//	.domain([1, 4])
			//	.range([50, 200]);

			//Default node size
			if ($(this).val() === '0') {
				nodeSizeScale = nodeSizeScaleFC;
				d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select("#PlogFCInput").style("display", "none");
				d3.select("#GlogFCInput4Size").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "none");
				d3.select("#GDAInput4Size").style("display", "none");
				d3.select("#TEInput4Size").style("display", "none");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));



			} else if ($(this).val() === '1') { //Node size based on genomic logFC

				nodeSize_sel = nodeSize;
				//nodeSizeScale = nodeSizeScaleFC;
				nodeSizeScale = d3.scale.linear()
					.domain([1, 4])
					.range([min_base_node_size, max_base_node_size1]);
				d3.select("#GlogFCInput4Size").style("display", "block");
				d3.select("#PlogFCInput").style("display", "none");
				d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "none");
				d3.select("#TEInput4Size").style("display", "none");
				d3.select("#GDAInput4Size").style("display", "none");
				$("#GlogFCID4Size").val('none');
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));
			} else if ($(this).val() === '2') { //Node size based on p-values from trait
				nodeSizeScale = nodeSizeScalePval;
				d3.select("#GlogFCInput4Size").style("display", "none");
				d3.select("#PlogFCInput").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "none");
				d3.select("#TEInput4Size").style("display", "none");
				d3.select("#druggabilityInput4Size").style("display", "block");
				d3.select("#GDAInput4Size").style("display", "none");
				$("#druggabilityID4Size").val('none');
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));


			} else if ($(this).val() === '3') { //Node size based on p-values from GWAS

				nodeSizeScale = nodeSizeScalePval;
				d3.select("#GlogFCInput4Size").style("display", "none");
				d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "block");
				d3.select("#TEInput4Size").style("display", "none");
				d3.select("#PlogFCInput").style("display", "none");
				d3.select("#GDAInput4Size").style("display", "none");
				$("#gwasID4Size").val('none');
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));
			} else if ($(this).val() === '4') { //Node size based on p-values from GWAS

				nodeSizeScale = nodeSizeScalePval;
				d3.select("#GlogFCInput4Size").style("display", "none");
				d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "none");
				d3.select("#TEInput4Size").style("display", "block");
				d3.select("#PlogFCInput").style("display", "none");
				d3.select("#GDAInput4Size").style("display", "none");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));


			} else if ($(this).val() === '5') { //Node size based on p-values from GWAS

				nodeSizeScale = nodeSizeScalePval;
				d3.select("#GDAInput4Size").style("display", "block");
				d3.select("#GlogFCInput4Size").style("display", "none");
				d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select("#gwasInput4Size").style("display", "none");
				d3.select("#TEInput4Size").style("display", "none");
				d3.select("#PlogFCInput").style("display", "none");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.size(function (d) {
							return Math.PI * Math.pow(nominal_base_node_size, 2);
						})
						.type(function (d) {
							return "circle"; /*d.type;*/
						}));


			}



			d3.selectAll("text.text").attr("dx", function (d) { //Change the position of label according to node size
				// console.log("nodeSize", d[nodeSize]);
				return (size(nodeSizeScale(Math.abs(Number(d[nodeSize])))) || nominal_base_node_size);

			})

		});


		//*********************************SHAPE ******************************************************

		///Node Shape

		$("input[name='nodeShape']").change(function () {
			//Reset to default color
			if ($(this).val() === '0') {

				d3.select("#pathwayShapeInput").style("display", "none");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							return "square";
						}))
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "none");


			} else if ($(this).val() === '1') { //shape based on (Directions: up/down/none)
				// $('#Direction').
				d3.select("#directionShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							console.log();
							if (d.direction >= 1) {
								return "diamond";
							}
						}))

				d3.select("#pathwayShapeInput").style("display", "none");
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "none");


			} else if ($(this).val() === '2') { //Shape based on pathway

				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#pathwayShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							if (d.direction >= 1) {
								return "diamond";
							}
						}))
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "none");


			} else if ($(this).val() === '3') { //color based on presence in Trait/s

				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#pathwayShapeInput").style("display", "none");
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							console.log();
							if (d.direction >= 1) {
								return "diamond";
							}
						}))
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "none");

			} else if ($(this).val() === '4') { //GWAS values

				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#pathwayShapeInput").style("display", "none");
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							console.log();
							if (d.direction >= 1) {
								return "diamond";
							}
						}))
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "none");

			} else if ($(this).val() === '5') { //Databases

				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#pathwayShapeInput").style("display", "none");
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							console.log();
							if (d.direction >= 1) {
								return "diamond";
							}
						}))
				d3.select("#celltypemarkerShapeInput").style("display", "none");


			} else if ($(this).val() === '6') { //color based on differential expression (linear scale)

				d3.select("#directionShapeInput").style("display", "none");
				d3.select("#pathwayShapeInput").style("display", "none");
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select("#traitShapeInput").style("display", "none");
				d3.select("#GWASShapeInput").style("display", "none");
				d3.select("#DBsShapeInput").style("display", "none");
				d3.select("#celltypemarkerShapeInput").style("display", "block");
				d3.selectAll(".node").select("path")
					.attr("d", d3.svg.symbol()
						.type(function (d) {
							console.log();
							if (d.direction >= 1) {
								return "diamond";
							}
						}))


			} else if ($(this).val() === '7') { //color based on differential expression (linear scale)

				//d3.selectAll(".node").select("path")
				//.style("fill", function(d) {
				d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
					return default_node_color;
				});
				/*d3.selectAll("stop[offset='100%']").style("stop-color",  function(d) {
				return expressionColor(Number(d.logFC));
				});*/
				d3.select("#logFCInput").style("display", "none");
				d3.select("#pathwayInput").style("display", "none");
				//d3.select("#druggabilityInput4Size").style("display", "none");
				d3.select(".legendExpression").attr("opacity", 1);
				d3.select(".legendDirection").attr("opacity", 0);
				d3.select(".legendPathway").attr("opacity", 0);
				d3.select("#directionInput").style("display", "none");
				d3.select("#druggabilityInput").style("display", "none");
				d3.select("#GWASInput").style("display", "none");
				d3.select("#DBsInput").style("display", "none");
				d3.select("#celltypemarkerInput").style("display", "block");


			}

		});

		//radial analysis

		$("input[name='radialAnylisis']").change(function () {
			radialAnylisis = '';

			if ($(this).val() === '0') {
				$('.slidecontainer').hide();
			} else if ($(this).val() === '1') {
				$('.slidecontainer').hide();
				$('#EdgeWeightCutOffRange').show();
			} else if ($(this).val() === '2') {
				$('.slidecontainer').hide();
				$('#nodeDegreeInput4Size').show();
			} else if ($(this).val() === '3') {
				$('.slidecontainer').hide();
				$('#HubGenesRange').show();
			} else if ($(this).val() === '4') {
				$('.slidecontainer').hide();
				$('#db4weight').show();
			}

		});


		// force setting
		$("input[name='force_setting']").change(function () {
			force_setting = '';

			if ($(this).val() === '0') {
				$('.forcecontainer').hide();
			} else if ($(this).val() === '1') {
				$('.forcecontainer').hide();
				$('#linkdistanceRange').show();
			} else if ($(this).val() === '2') {
				$('.forcecontainer').hide();
				$('#linkchargeRange').show();
			} else if ($(this).val() === '3') {
				$('.forcecontainer').hide();
				$('#linkStrengthRange').show();
			}

		})


		// network parameters
		$("input[name='network_parameters']").change(function () {

			if ($(this).val() === '0') {
				// resetText();
			    $('.networkcontainer').hide();
			} else if ($(this).val() === '1') {
				// resetText();
				$('.networkcontainer').hide();
				$('#color_range').show();
			} else if ($(this).val() === '2') {
				// resetText();
				$('.networkcontainer').hide();
				$('#opacity_range').show();
			} else if ($(this).val() === '3') {
				// resetText();
				$('.networkcontainer').hide();
				$('#node_size').show();
			} else if ($(this).val() === '4') {
				// resetText();
				$('.networkcontainer').hide();
				$('#text_size').show();
			// } else if ($(this).val() === '5') {
			// 	$('.networkcontainer').hide();
			// 	$('#zoom_network').show();
			}
		})

		$("input[name='highlight_seedEdge'][value='6']").change(function () {
					if ($(this).is(':checked')){
						highlightNodes();
					}else{
						removeHighlightNodes();
					}
        })

	

		// color scheme values and output
		function colorFinc() {
			var red = document.getElementById("redRange");
			var blue = document.getElementById("greenRange");
			var green = document.getElementById("blueRange");
			var color_ouput = document.getElementById("color_ouput");
			var rRange = document.getElementById("rRange");
			var gRange = document.getElementById("gRange");
			var bRange = document.getElementById("bRange");

			rRange.innerHTML = red.value
			gRange.innerHTML = blue.value
			bRange.innerHTML = green.value

			color_ouput.style.background = `rgb(${red.value},${blue.value},${green.value})`
			default_node_color = `rgb(${red.value},${blue.value},${green.value})`

			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				return default_node_color;
			});

		}

		// color scheme values and output

		function highlightNodes() {
			let totalData = getItemFromStorage('pd_net_stringDB');
			if (totalData != undefined || totalData != null) {
			let d = JSON.parse(totalData);
			for (let i of d.nodeNames) {
						y = i.split(/\s*[,\n]+\s*[,\n]*\s*/);
				    	color_input_genes2(y);
					}
				}
			}


		function removeHighlightNodes() {
			let totalData = getItemFromStorage('pd_net_stringDB');
			if (totalData != undefined || totalData != null) {
				let d = JSON.parse(totalData);
				for (let i of d.nodeNames) {
					y = i.split(/\s*[,\n]+\s*[,\n]*\s*/);
				    remove_input_genes(y);
				}
			}
		}

		function remove_input_genes(y) {
		  	d3.selectAll(".node").each(function (d) {
		  		if (y.indexOf(d.Gene_name) > -1 || y.indexOf(d.ID) > -1) {
					d3.selectAll("*[id^=" + d.ID.replace(/\./g, 'DOT') + "_]," + "*[id$=_" + d.Gene_name
					.replace(/\./g, 'DOT') + "]").select("stop[offset='100%']")
					.style("stop-color", default_node_color);
				}
		  	})
		}

		// link opacity
		function opacityFunc() {
			var opacityRange = document.getElementById("opacityRange");

			var oRange = document.getElementById("oRange");
			oRange.innerHTML = opacityRange.value
			link.style("opacity", opacityRange.value)
		}

		// node size change
		function nodeSizeFunc() {
			var nodeRange = document.getElementById("nodeRange");
			var nRange = document.getElementById("nRange");
			nRange.innerHTML = nodeRange.value
			nominal_base_node_size = nodeRange.value
			// link.style("opacity", nodeRange.value)
			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					.size(function (d) {
						return Math.PI * Math.pow(nominal_base_node_size, 2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}

		// zoom range

		function zoomClick() {
			var width = window.innerWidth,
				height = window.innerHeight;
			// console.log('TARGET:', d3.event.target)
			// var closeModal = d3.event.target;
			// console.log(d3.event)
			d3.attr("zoom", function () {
				// console.log("kdmf")
			})

		}
		d3.selectAll('.zoom_btn').on('click', zoomClick);

		// Getting the text value anyTime
		function getTextRangeVal() {
			var textRange = document.getElementById("textRange");
			console.log('tZ->', textRange.value)
		}

		// text size chnage
		function textSizeFunc() {
			var textRange = document.getElementById("textRange");

			var tRange = document.getElementById("tRange");
			tRange.innerHTML = textRange.value
			max_text_size = textRange.value
			// link.style("opacity", opacityRange.value)
			nominal_text_size = textRange.value
			text.style("font-size", nominal_text_size + "px");
		}
		// reset layoyt
		function resetLayout() {
			linkdistanceinput.innerHTML = 15
			linkchargeinput.innerHTML = -200
			linkStrengthinput.innerHTML = 20

			force.linkDistance(15)
				.charge(-200)
				.distance(20)

			force.start()
		}


		function reset_param() {
			var red = document.getElementById("redRange");
			var blue = document.getElementById("greenRange");
			var green = document.getElementById("blueRange");
			var color_ouput = document.getElementById("color_ouput");
			var rRange = document.getElementById("rRange");
			var gRange = document.getElementById("gRange");
			var bRange = document.getElementById("bRange");

			red.value = 23
			blue.value = 190
			green.value = 207
			rRange.innerHTML = 23
			gRange.innerHTML = 190
			bRange.innerHTML = 207
			color_ouput.style.background = "rgb(23, 190, 207)"
			default_node_color = "rgb(23, 190, 207)"

			d3.selectAll("stop[offset='100%']").style("stop-color", function (d) {
				return default_node_color;
			});
			var textRange = document.getElementById("textRange");
			textRange.value = 8;
			var tRange = document.getElementById("tRange");
			tRange.innerHTML = 8;

			// link.style("opacity", opacityRange.value)
			nominal_text_size = 8;
			text.style("font-size", nominal_text_size + "px");

			var nodeRange = document.getElementById("nodeRange");
			var nRange = document.getElementById("nRange");
			nodeRange.value = 8;
			nRange.innerHTML = 8;
			nominal_base_node_size = 8;
			max_text_size = 10
			// link.style("opacity", nodeRange.value)
			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					.size(function (d) {
						return Math.PI * Math.pow(nominal_base_node_size, 2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));


			var opacityRange = document.getElementById("opacityRange");
			opacityRange.value = 1
			var oRange = document.getElementById("oRange");
			oRange.innerHTML = 1
			link.style("opacity", 1)
		}


		// on seleting node cutoff , change in node degree and relevence

		document.getElementById("nodeDegreeID4Size").onchange = function () {			
			var cutoff_type = document.getElementById("nodeDegreeID4Size").value;
			// console.log("cutoff_type == ", cutoff_type)
			if (cutoff_type == "node_degree") {
				$("#NodeDegreeRange").show()
			} else {
				$("#NodeDegreeRange").hide()
			}	
		}

		
		document.getElementById("collapseExampleThree").onchange = function () {
		  var nodeDegreeId = document.getElementById("NodeDegree").value;
		  if (nodeDegreeId == "2") {		
			var cutoff_type = document.getElementById("nodeDegreeID4Size").value;
			if (cutoff_type == "node_degree") {
				$("#NodeDegreeRange").show()
			} else {
				$("#NodeDegreeRange").hide()
			}
			let val2;
			if (/TE/.test(cutoff_type)) {	
				var allTEvalues = [];			
				d3.selectAll(".node").select("path")
				.attr("dTest", d3.svg.symbol()
					.size(function (dTest) {
						 val2 = (currentUniversal?.genes[geneIndexMap[dTest.ID]][document.getElementById("nodeDegreeID4Size").value]) ?? 0;
						 	allTEvalues.push(val2);
					})
				);
				let newVal;
				const minTEval = Math.min(...allTEvalues).toFixed(2);
				const maxTEval = Math.max(...allTEvalues).toFixed(2);			
				const TErangeInput = document.getElementById('myTEvalues');		
    			TErangeInput.min = minTEval;
   	 			TErangeInput.max = maxTEval;
				TErangeInput.addEventListener('input', function() {
        			document.getElementById('thresh3').textContent = this.value;
    			});
    			 document.getElementById('thresh3').textContent = TErangeInput.value;
				$("#TERange").show()
			} else {
				$("#TERange").hide()
			}
	      }
	    }

		//on selecting Genomic LogFC, change the size of nodes

		document.getElementById("GlogFCID4Size").onchange = function () {

			// uniNode.genes[d.ID][uniNode.headers[nodeSize]]
			nodeSize = document.getElementById("GlogFCID4Size").value;
			nodeSize_sel = nodeSize;

			nodeSizeScale = getNodeSizeScale(nodeSize_sel);

			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					//.size(function(d) { return 600 })
					//.size(function(d) { return Math.PI*Math.pow(nominal_base_node_size,2); })
					.size(function (d) {

						//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
						//thisNodeSize = uniNode.genes[d.ID] ? size(nodeSizeScale(Math.pow(2,Math.abs(Number(uniNode.genes[d.ID][uniNode.headers[nodeSize]]))))) : "";
						let val = Number(currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GlogFCID4Size").value]) ?? undefined;
						let thisNodeSize = val ? size(nodeSizeScale(Math.abs(val))) : 0;
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
						//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize]))))) || nominal_base_node_size,2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}
		///=======

		//on selecting GWAS score, change the size of nodes

		document.getElementById("gwasID4Size").onchange = function () {

			// uniNode.genes[d.ID][uniNode.headers[nodeSize]]
			nodeSize = document.getElementById("gwasID4Size").value;
			nodeSize_sel = nodeSize;

			nodeSizeScale = getNodeSizeScale(nodeSize_sel);

			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					//.size(function(d) { return 600 })
					//.size(function(d) { return Math.PI*Math.pow(nominal_base_node_size,2); })
					.size(function (d) {

						//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
						//thisNodeSize = uniNode.genes[d.ID] ? size(nodeSizeScale(Math.pow(2,Math.abs(Number(uniNode.genes[d.ID][uniNode.headers[nodeSize]]))))) : "";
						let val = Number(currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("gwasID4Size").value]) ?? undefined;
						let thisNodeSize = val ? size(nodeSizeScale(Math.abs(val))) : 0;
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
						//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize]))))) || nominal_base_node_size,2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}
		///=======


		document.getElementById("GDAID4Size").onchange = function () {

			// uniNode.genes[d.ID][uniNode.headers[nodeSize]]
			nodeSize = document.getElementById("GDAID4Size").value;
			nodeSize_sel = nodeSize;

			nodeSizeScale = getNodeSizeScale(nodeSize_sel);

			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					//.size(function(d) { return 600 })
					//.size(function(d) { return Math.PI*Math.pow(nominal_base_node_size,2); })
					.size(function (d) {

						//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
						//console.log(uniNode.genes[d.ID])
						//thisNodeSize = uniNode.genes[d.ID] ? size(nodeSizeScale(Math.pow(2,Math.abs(Number(uniNode.genes[d.ID][uniNode.headers[nodeSize]]))))) : "";
						let val = Number(currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("GDAID4Size").value]) ?? undefined;
						let thisNodeSize = val ? size(nodeSizeScale(Math.abs(val))) : 0;
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
						//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize]))))) || nominal_base_node_size,2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}


		//on selecting Proteomic LogFC, change the size of nodes

		// document.getElementById("PlogFCID4Size").onchange = function () {


		// 	nodeSize = document.getElementById("PlogFCID4Size").value;
		// 	nodeSize_sel = nodeSize;

		// 	nodeSizeScale = getNodeSizeScale(nodeSize_sel);

		// 	d3.selectAll(".node").select("path")
		// 		.attr("d", d3.svg.symbol()
		// 			//.size(function(d) { return 600 })
		// 			//.size(function(d) { return Math.PI*Math.pow(nominal_base_node_size,2); })
		// 			.size(function (d) {

		// 				//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
		// 				//console.log(uniNode.genes[d.ID])
		// 				thisNodeSize = uniNode.genes[d.ID] ?
		// 					size(nodeSizeScale(typeof uniNode.genes[d.ID][uniNode.headers[nodeSize_sel]] == "number" ? Math.abs(uniNode.genes[d.ID][uniNode.headers[nodeSize_sel]]) : 0)) :
		// 					"";
		// 				return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size : thisNodeSize || nominal_base_node_size, 2);
		// 				//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize]))))) || nominal_base_node_size,2);
		// 			})
		// 			//.logFC(function(d) {
		// 			//CKECK FROM
		// 			//	return  uniNode.genes[d.ID] ? size(nodeSizeScale(Math.pow(2,Math.abs(Number(uniNode.genes[d.ID][uniNode.headers[nodeSize]]))))) : "";
		// 			//})
		// 			.type(function (d) { return "circle";/*d.type;*/ }))
		// 		;



		// }

		//on selecting trait name, change the size of nodes

		document.getElementById("druggabilityID4Size").onchange = function () {
     		nodeSize = document.getElementById("druggabilityID4Size").value;
			nodeSize_sel = nodeSize;

			nodeSizeScale = getNodeSizeScale(nodeSize_sel);

			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					//.size(function(d) { return 600 })
					//.size(function(d) { return Math.PI*Math.pow(nominal_base_node_size,2); })
					.size(function (d) {

						//thisNodeSize = size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize])))));
						//console.log(uniNode.genes[d.ID])
						let val = Number(currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("druggabilityID4Size").value]) ?? undefined;
						let thisNodeSize = val ? size(nodeSizeScale(Math.abs(val))) : 0;
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
						//return Math.PI*Math.pow(size(nodeSizeScale(Math.pow(2,Math.abs(Number(d[nodeSize]))))) || nominal_base_node_size,2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}


		document.getElementById("TE4Size").onchange = function () {
			nodeSize = document.getElementById("TE4Size").value;
			nodeSize_sel = nodeSize;
			nodeSizeScale = getNodeSizeScale(nodeSize_sel);
			d3.selectAll(".node").select("path")
				.attr("d", d3.svg.symbol()
					.size(function (d) {
						let val = Number(currentUniversal?.genes[geneIndexMap[d.ID]][document.getElementById("TE4Size").value]) ?? undefined;
						let thisNodeSize = val ? size(nodeSizeScale(Math.abs(val))) : 0;
						return Math.PI * Math.pow(thisNodeSize > max_base_node_size ? max_base_node_size :
							thisNodeSize || nominal_base_node_size, 2);
					})
					.type(function (d) {
						return "circle"; /*d.type;*/
					}));
		}

		//Gradient Legend for the network

		var svg2 = d3.select("div#legendPanel").append("svg").attr("width", 150).attr("height", 100).attr("class",
			"legendSVG");

		var legendExpression = svg2.append("g").attr("class", "legendExpression")
			.attr("transform", "translate(50,0)")
			.style("font-size", "18px");

		var color = d3.scale.category10();
		var linear = d3.scale.linear()
			.domain([0, 5, 10])
			.range(["red", default_node_color, "green"]);
		//.range(["red", "rgb(105,105,105)", "green"]);


		var legendExpression = d3.legend.color()
			.shapeWidth(10)
			.shapeHeight(10)
			.cells([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
			.shapePadding(6)
			.labelOffset(10)
			.scale(linear)
			//.orient("horizontal")
			.labels(["", "Up", "", "", "", "Baseline", "", "", "", "Down"])
			.labelAlign("start");

		svg2.select(".legendExpression")
			.call(legendExpression);

		d3.select(".legendExpression").attr("opacity", 0);


		//Circle legend

		var nodeColorScale = d3.scale.ordinal().domain(["UP", "NONE", "DOWN"]).range(["red", default_node_color, "green"]);


		var legendDirection = svg2.append("g").attr("class", "legendDirection")
			.attr("transform", "translate(40,10)")
			.style("font-size", "18px");

		// Node color legend
		//footer.append("g")
		//.attr("class", "legendColor")
		//.attr("transform", "translate(20,20)");

		var legendDirection = d3.legend.color()
			.shape("circle")
			.shapeRadius(10)
			.shapePadding(25)
			.orient('vertical')
			.scale(nodeColorScale);

		svg2.select(".legendDirection").call(legendDirection);


		var nodeColorScalePathway = d3.scale.ordinal().domain(["Present", "Not-present"]).range(["red", default_node_color]);
		svg2.append("g").attr("class", " legendPathway")
			.attr("transform", "translate(20,10)")
			.style("font-size", "18px");

		var legendPathway = d3.legend.color()
			.shape("circle")
			.shapeRadius(10)
			.shapePadding(25)
			.orient('vertical')
			.scale(nodeColorScalePathway);

		svg2.select(".legendPathway").call(legendPathway);
		d3.select(".legendPathway").attr("opacity", 0);

		function settingFunc() {
			var x = document.getElementById("mysetting");
			// console.log(x.style.display)
			// if (x.style.display === "none") {
			// 	x.style.display = "block";
			// } else {
			// 	x.style.display = "none";
			// }
			if (x.style.display === "none") {
				$('.networksetting').css('top', '-100px')
				$('#mysetting').css('display', 'block')
			} else {
				$('.networksetting').css('top', '0')
				$('#mysetting').css('display', 'none')
			}
		}
		// d3.selectAll('circle')
		// .on('click', function(d, i) {
		// 	d3.select('.status')
		// 	.text('You closeModal on circle ' + i, d);
		// });
	</script>

<!--Show Legends Based on Node Color selection-->
<script>
    // Function to reset the legend panel
    function resetLegends() {
      d3.select(".legendExpression").attr("opacity", 0); // Hide legendExpression by default
      d3.select(".legendPathway").attr("opacity", 0);    // Hide legendPathway by default
     // d3.select(".legendDirection").attr("opacity",0);
    }
    // Function to show legendExpression
    function showLegendExpression() {
      resetLegends();
      d3.select(".legendExpression").attr("opacity", 1); // Show the expression legend
    }
    // Function to show legendDirection
    function showLegendDirection(){
     d3.select(".legendDirection").attr("opacity", 1)
    }
    // Function to show legendPathway
    function showLegendPathway() {
      resetLegends();
      d3.select(".legendPathway").attr("opacity", 1); // Show the pathway legend
    }
    // Event listener for radio button selection
    document.querySelectorAll('input[name="nodeColor"]').forEach((radio) => {
      radio.addEventListener('change', function () {
        const selectedValue = this.value;
        switch (selectedValue) {
          case "0":
		  case "8":
            showLegendDirection();
            break;
          case "2": // logFC
          case "9": // GDA
          case "5": // Genetics
          case "4": // Druggability
          case "12": // TE
            showLegendExpression(); // Show legendExpression for these options
            break;
          case "6": // Databases
          case "3": // Pathways
            showLegendPathway();
            break;
          default:
            resetLegends(); // Reset if none or custom options selected
        }
      });
    });
    // Initialize the legends as hidden
    resetLegends();
  </script>